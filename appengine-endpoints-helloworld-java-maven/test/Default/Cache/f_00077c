function _generalUtils(){}function _StringUtils(){}function AdElement(e){this._vpaid=e,this._linear={},this._skipoffset=0,this._nonLinearAds=null,this._companionAdXML="",this._3pLinearTrackingEventMap=null,this._pmLinearTrackingEventMap=null,this._3pNonLinearTrackingEventMap=null,this._pmNonLinearTrackingEventMap=null,this._3pVideoClickEvents=null,this._pmVideoClickEvents=null,this._3pImpressionEvents=null,this._pmImpressionEvents=null,this._3pErrorEvents=null,this._pmErrorEvents=null,this._bestMediaFileIndex=0,this._bestNonLinearCreativeIndex=0,this._linear.videoClicks={},this._3pLinearTrackingEventMap={},this._3pNonLinearTrackingEventMap={},this._3pVideoClickEvents=[],this._3pImpressionEvents=[],this._pmLinearTrackingEventMap={},this._pmNonLinearTrackingEventMap={},this._pmVideoClickEvents=[],this._pmImpressionEvents=[],this._3pErrorEvents=[],this._pmErrorEvents=[]}function ErrorData(e,t){this.errorCode=e,this.errorMessage=t}function AdTagHandler(e,t,i){this._adTag,this._vpaid=null,this._creativeHandlers=i||[],this._adTag=e,this._vpaid=t}function CreativeHandler(e,t){this._creativeHandlers,this._pmVPAID=null,this._currentWinAdNetworkId=0,this._winCampaignId=0,this._currentWinCampaignId=0,this._winCampaignIds=[],this._lastWinAdNetworkId=0,this._oid="",this._isPMADServerResp,this._passbackCounter=0,this._wrapperCounter=0,this._creativeHandlers=e,this._pmVPAID=t,this._adElement=this._pmVPAID.getAdElement()||new AdElement(this._pmVPAID),this._isPMADServerResp=!0}function ErrorHandler(e){this._errorData=e}function EventHandler(){}function _JSInterfaceHandler(){}function _AdParamConfigReader(){}function AdResponseValidator(e){this._respData,this.vast=null,this._companionAds,this.COMPANION_ADS_START_TOKEN_PARTIAL="<CompanionAds",this.AD_END_TOKEN="</Ad>",this._respData=e,this._companionAds=[]}function CommandButton(e,t){var i=document.createElement("label");return i.id=t,i.innerHTML=e,i.style.cssText="cursor: pointer;border: 1px solid;border-radius: 0.25em;color: rgb(255, 255, 255);display: inline;font-size: 75%;font-weight: bold;line-height: 1;padding: 0.2em 0.6em 0.3em;text-align: center;vertical-align: baseline;white-space: nowrap;margin-left: -25px;right: 0px;bottom: 50px;position: absolute;background-color: black;padding: 8px;opacity: .7;font: normal 12px arial,helvetica,sans-serif;",i}function _Logger(){this.logPrefix="pm-",this.debugLevel=0,this._logDispatcher=null}function URLParser(e){this._url=null,this._domainName="",this._urlVariables=null,this._protocol=null,this._filepathWithProtocol=null,this._filenameNoExtention=null,this._url=e,this._domainName="",this._urlVariables={},this.init(e)}function URLVariables(e){return this.kadNetwork=this.getParameterByName(e,"kadNetwork"),this.defaultedAdServerId=this.getParameterByName(e,"defaultedAdServerId"),this.campaignId=this.getParameterByName(e,"campaignId"),this.adServerId=this.getParameterByName(e,"adServerId"),this.oid=this.getParameterByName(e,"oid"),this}function Loader(){this.staticResource=null}function _MediaClient(){}function OverlayAdPlayer(e,t,i,r){this._pmVPAIDObj=r,this._initWidth=0,this._initHeight=0,this._adElement,this._nonLinearAdTimmer=null,this._loader=null,this._pmVPAID=null,this._nonLinear=null,this._closeButton=null,this._loader=this,this._initWidth=e,this._initHeight=t,this._adElement=i,this._pmVPAID=this._pmVPAIDObj.getInstance(),this._nonLinear=this._adElement.getNonLinearAds().nonLinears[this._adElement.getNonLinearCreativeIndex()],this._closeButton=new CommandButton("X","_pmClose"),this._closeButton.addEventListener?this._closeButton.addEventListener("click",function(e){return function(){e.onCloseAd()}}(this),!1):this._closeButton.attachEvent("onclick",this.onCloseAd)}function PMVideoPlayer(e,t,i){this._initWidth=0,this._initHeight=0,this._viewMode="Normal",this._desiredBitrate=0,this._creativeData="",this._environmentVars="",this._pmVPAID=i,this._video=null,this._totalAdDuration,this._overlayPlayer=null,this._urlParser=new URLParser,this._startQuartileFlag=!0,this._firstQuartileFlag=!0,this._midpointFlag=!0,this._thirdQuartileFlag=!0,this._completeFlag=!0,this._adElement=null,this._isLinearAd=e,this._isLinearAd&&(this._video=t),this.isPaused=!1,this.skobj=null}function xmlToJson(e){"use strict";function t(){void 0===e.escapeMode&&(e.escapeMode=!0),e.attributePrefix=e.attributePrefix||"_",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[]}function i(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),"function"!=typeof Date.prototype.toISOString&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"})}function r(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function n(e){return e.prefix}function a(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):e}function o(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function s(t,i,r){switch(e.arrayAccessForm){case"property":t[i]instanceof Array?t[i+"_asArray"]=t[i]:t[i+"_asArray"]=[t[i]]}if(!(t[i]instanceof Array)&&e.arrayAccessFormPaths.length>0){for(var n=0;n<e.arrayAccessFormPaths.length;n++){var a=e.arrayAccessFormPaths[n];if("string"==typeof a){if(a==r)break}else if(a instanceof RegExp){if(a.test(r))break}else if("function"==typeof a&&a(t,i,r))break}n!=e.arrayAccessFormPaths.length&&(t[i]=[t[i]])}}function d(e){var t=e.split(/[-T:+Z]/g),i=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");if(i.setHours(t[3],t[4],r[0]),r.length>1&&i.setMilliseconds(r[1]),t[6]&&t[7]){var n=60*t[6]+Number(t[7]),a=/\d\d-\d\d:\d\d$/.test(e)?"-":"+";n=0+("-"==a?-1*n:n),i.setMinutes(i.getMinutes()-n-i.getTimezoneOffset())}else e.indexOf("Z",e.length-1)!==-1&&(i=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())));return i}function l(t,i,r){if(e.datetimeAccessFormPaths.length>0){for(var n=r.split(".#")[0],a=0;a<e.datetimeAccessFormPaths.length;a++){var o=e.datetimeAccessFormPaths[a];if("string"==typeof o){if(o==n)break}else if(o instanceof RegExp){if(o.test(n))break}else if("function"==typeof o&&o(obj,i,n))break}return a!=e.datetimeAccessFormPaths.length?d(t):t}return t}function p(t,i){if(t.nodeType==y.DOCUMENT_NODE){for(var a=new Object,d=t.childNodes,h=0;h<d.length;h++){var A=d.item(h);if(A.nodeType==y.ELEMENT_NODE){var _=r(A);a[_]=p(A,_)}}return a}if(t.nodeType==y.ELEMENT_NODE){var a=new Object;a.__cnt=0;for(var d=t.childNodes,h=0;h<d.length;h++){var A=d.item(h),_=r(A);A.nodeType!=y.COMMENT_NODE&&(a.__cnt++,null==a[_]?(a[_]=p(A,i+"."+_),s(a,_,i+"."+_)):(null!=a[_]&&(a[_]instanceof Array||(a[_]=[a[_]],s(a,_,i+"."+_))),a[_][a[_].length]=p(A,i+"."+_)))}for(var c=0;c<t.attributes.length;c++){var g=t.attributes.item(c);a.__cnt++,a[e.attributePrefix+g.name]=g.value}var u=n(t);return null!=u&&""!=u&&(a.__cnt++,a.__prefix=u),null!=a["#text"]&&(a.__text=a["#text"],a.__text instanceof Array&&(a.__text=a.__text.join("\n")),e.escapeMode&&(a.__text=o(a.__text)),e.stripWhitespaces&&(a.__text=a.__text.trim()),delete a["#text"],"property"==e.arrayAccessForm&&delete a["#text_asArray"],a.__text=l(a.__text,_,i+"."+_)),null!=a["#cdata-section"]&&(a.__cdata=a["#cdata-section"],delete a["#cdata-section"],"property"==e.arrayAccessForm&&delete a["#cdata-section_asArray"]),1==a.__cnt&&null!=a.__text?a=a.__text:0==a.__cnt&&"text"==e.emptyNodeForm?a="":a.__cnt>1&&null!=a.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==a.__text||""==a.__text.trim())&&delete a.__text,delete a.__cnt,!e.enableToStringFunc||null==a.__text&&null==a.__cdata||(a.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),a}if(t.nodeType==y.TEXT_NODE||t.nodeType==y.CDATA_SECTION_NODE)return t.nodeValue}function h(t,i,r,n){var o="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+i;if(null!=r)for(var s=0;s<r.length;s++){var d=r[s],l=t[d];e.escapeMode&&(l=a(l)),o+=" "+d.substr(e.attributePrefix.length)+"='"+l+"'"}return o+=n?"/>":">"}function A(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function _(e,t){return e.indexOf(t,e.length-t.length)!==-1}function c(t,i){return!!("property"==e.arrayAccessForm&&_(i.toString(),"_asArray")||0==i.toString().indexOf(e.attributePrefix)||0==i.toString().indexOf("__")||t[i]instanceof Function)}function g(e){var t=0;if(e instanceof Object)for(var i in e)c(e,i)||t++;return t}function u(t){var i=[];if(t instanceof Object)for(var r in t)r.toString().indexOf("__")==-1&&0==r.toString().indexOf(e.attributePrefix)&&i.push(r);return i}function E(t){var i="";return null!=t.__cdata&&(i+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(i+=e.escapeMode?a(t.__text):t.__text),i}function P(t){var i="";return t instanceof Object?i+=E(t):null!=t&&(i+=e.escapeMode?a(t):t),i}function m(e,t,i){var r="";if(0==e.length)r+=h(e,t,i,!0);else for(var n=0;n<e.length;n++)r+=h(e[n],t,u(e[n]),!1),r+=v(e[n]),r+=A(e[n],t);return r}function v(e){var t="",i=g(e);if(i>0)for(var r in e)if(!c(e,r)){var n=e[r],a=u(n);if(null==n||void 0==n)t+=h(n,r,a,!0);else if(n instanceof Object)if(n instanceof Array)t+=m(n,r,a);else if(n instanceof Date)t+=h(n,r,a,!1),t+=n.toISOString(),t+=A(n,r);else{var o=g(n);o>0||null!=n.__text||null!=n.__cdata?(t+=h(n,r,a,!1),t+=v(n),t+=A(n,r)):t+=h(n,r,a,!0)}else t+=h(n,r,a,!1),t+=P(n),t+=A(n,r)}return t+=P(e)}var I="1.1.5";e=e||{},t(),i();var y={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(e){var t=window.ActiveXObject||"ActiveXObject"in window;if(void 0===e)return null;var i;if(window.DOMParser){var r=new window.DOMParser,n=null;if(t||(n=r.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI),i=r.parseFromString(e,"text/xml"),null!=n&&i.getElementsByTagNameNS(n,"parsererror").length>0)throw new Error("Error parsing XML: "+e)}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(e);return i},this.asArray=function(e){return e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?d(e):e},this.xml2json=function(e){return p(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return v(e)},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return I}}function Timer(e,t,i){this.delay=e,this.running=!1,this.repeat_count=t,this._timer=null,this.onCompleteFunc=i}function PMVpaidPlayer(e,t,i,r){this._initWidth=0,this._initHeight=0,this._viewMode="Normal",this._desiredBitrate=0,this._creativeData="",this._environmentVars="",this._loader,this._isLoaderRunnig=!1,this._tpVPAIDAdUrl=r,this._tpVPAIDAd=null,this._tpVPAIDAddom=null,this._tpVPAIDVersion,this._adStartRequested=!1,this._pmVPAID=i,this.onProtocolTimeOut=null,this._protocolTimer=null,this._isLinearAd=e,this._protocolTimer=new Timer(AdParamConfigReader.VPAID_PROTOCOL_TIMEOUT,1,this.onProtocolTimeOut)}_generalUtils.prototype.countObj=function(e,t){var i,r=0;for(i in t)t.hasOwnProperty(i)&&i==e&&r++;return r},_generalUtils.prototype.detectDevice=function(e){var t=0;try{var i=navigator.userAgent.toLowerCase();switch(e){case"ios":i.match(/(iphone|ipod|ipad)/)&&(t=parseFloat(i.match(/os ([0-9]+(_[0-9]+)?)/)[1].replace("_",".")))}}catch(e){}return t},_StringUtils.prototype.isBlank=function(e){function t(e){return!isNaN(parseFloat(e))&&isFinite(e)}var i=!0;return t(e)&&(i=!1),null!=e&&e.length>0&&(i=!1),i},_StringUtils.prototype.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},_StringUtils.prototype.stripWhitespaces=function(e){var t=/[ \t\n]+/g;return e.replace(t,"")},_StringUtils.prototype.toInteger=function(e){var t=StringUtils.isBlank(e)?0:parseInt(e);return t},_StringUtils.prototype.timecodeToSeconds=function(e){var t=e.split(":");return 3600*t[0]+60*t[1]+1*t[2]};var StringUtils=new _StringUtils,GeneralUtils=new _generalUtils,Constants={PM_AD_MGR_RELEASE_VERSION:"1.1.2",PM_VPAID_VERSION:"1.0",EQUAL_OP:"=",AMP_OP:"&",QUES_OP:"?",EMPTY_STRING:"",K_AD_NETWORK_CONST:"&kadNetwork=",DEF_CAMPG_IDS:"&defcmpgIDs=",LAST_DEF_ADNWK_ID:"&lastdefadnwkID=",OID:"&oid=",PUB_ID:"pubId",SITE_ID:"siteId",AD_ID:"adId",V_AD_FMT:"vadFmt",AD_TAG_TYPE:"adtagtype",V_MIN_L:"vminl",V_MAX_L:"vmaxl",SA_VERSION:"SAVersion",IN_I_FRAME:"inIframe",JS:"js",K_DNT_UID:"kdntuid",K_L_TSTAMP:"kltstamp",PAGE_URL:"pageURL",RAN_REQ:"ranreq",SCREEN_RESOLUTION:"screenResolution",SEC:"sec",TIMEZONE:"timezone",COPPA:"coppa",AT_PAYLOAD:"at_payload",V_TYPE:"vtype",K_AD_HEIGHT:"kAdHeight",K_AD_WIDTH:"kAdWidth",V_X_LOC:"vxloc",V_Y_LOC:"vyloc",V_MIN_BTR:"vminbtr",V_MAX_BTR:"vmaxbtr",V_COM:"vcom",V_COMW:"vcomw",V_COMH:"vcomh",V_API:"vapi",V_FMT:"vfmt",V_CONT:"vcont",V_PLAY:"vplay",V_POS:"vpos",PLAYER_HEIGHT:"vh",PLAYER_WIDTH:"vw",WIN_HEIGHT:"vwndh",WIN_WIDTH:"vwndw",AD_HEIGHT:"vadh",AD_WIDTH:"vadw",WIN_URL:"vwndurl",REF_URL:"vwndref",DEPTH:"depth",PLAYER_LOCATION:"adPosition",PLAYER_LOCATION_X:"plocx",PLAYER_LOCATION_Y:"plocy",PLAYER_VISIBILITY:"adVisibility",AD_CODEC:"video/x-f4v,video/x-mp4,video/x-m4a,video/x-mov,video/x-mp4v,video/x-3gp,video/x-3g2,video/x-flv,video/x-h.264,application/x-shockwave-flash",V_POSITION:{0:"ANY",1:"PRE_ROLL",2:"IN_ROLL",3:"POST_ROLL"},VPAID_API:{1:"VPAID1.0",2:"VPAID2.0"},V_PLAYBACK:{1:"AUTO_PLAY_SOUND_ON",2:"AUTO_PLAY_SOUND_OFF",3:"CLICK_TO_PLAY",4:"MOUSE_OVER"},VPAID_STR:"VPAID",VIEW_MODE_FULLSCREEN:"fullscreen",V_CAMPAIGN_NETWORK_ID:243,RTMP_PROTOCOL:"rtmp",COMPANION_ADS_START_TOKEN:"<CompanionAds>",COMPANION_ADS_END_TOKEN:"</CompanionAds>",PM_VPAID_FILE_NAME:"PMAdMgr.js",SECURE_PROTOCOL:"https:",UNSECURE_PROTOCOL:"http:"},ErrorMessage={VAST_PARSING_ERROR:new ErrorData(100,"XML parsing error."),VAST_VALIDATION_ERROR:new ErrorData(101,"VAST schema validation error."),VAST_VERSION_ERROR:new ErrorData(102,"VAST version of response not supported."),UNEXCEPTED_OR_UNSUPPORTED_AD_ERROR:new ErrorData(200,"Trafficking error. Video player received an ad type that it was not expecting and/or cannot display."),LINEARITY_ERROR:new ErrorData(201,"Video player expecting different linearity."),DURATION_ERROR:new ErrorData(202,"Video player expecting different duration."),ADSIZE_ERROR:new ErrorData(203,"Video player expecting different size."),WRAPPER_ERROR:new ErrorData(300,"General Wrapper error."),VAST_URI_ERROR:new ErrorData(301,"Timeout of VAST URI provided in Wrapper element, or of VAST URI provided in a subsequent Wrapper element. Includes request errors such as invalid URI, unreachable or request timeout for URI, and security or other exceptions related to requesting a VAST URI."),WRAPPER_LIMIT_ERROR:new ErrorData(302,"Wrapper limit reached, as defined by the video player. Too many Wrapper responses have been received with no InLine response."),EMPTY_OR_NO_ADS_VAST_ERROR:new ErrorData(303,"No ads VAST response after one or more Wrappers. Also includes number of empty VAST responses from fallback."),LINEAR_ADS_GENERAL_ERROR:new ErrorData(400,"General linear error. Video player is unable to display the linear ad."),MEDIA_FILE_NOT_FOUND_ERROR:new ErrorData(401,"File not found. Unable to find Linear/MediaFile from URI."),TIMEOUT_MEDIA_FILE_ERROR:new ErrorData(402,"Timeout of MediaFile URI."),UNSUPPORTED_MEDIA_FILE_ERROR:new ErrorData(403,"Could not find MediaFile that is supported by this video player, based on the attributes of the MediaFile element."),MEDIA_FILE_GENERAL_ERROR:new ErrorData(405,"Problem displaying MediaFile."),NON_LINEAR_ADS_GENERAL_ERROR:new ErrorData(500,"General NonLinearAds error."),NON_LINEAR_ADS_UNSUITBALE_DIMENSION_ERROR:new ErrorData(501,"Unable to display NonLinear Ad because creative dimensions do not align with creative display area (i.e., creative dimension too large)."),NON_LINEAR_ADS_CREATIVE_ERROR:new ErrorData(502,"Unable to fetch NonLinearAds/NonLinear resource."),UNSUPPORTED_NONLINEAR__ADS_CREATIVE_ERROR:new ErrorData(503,"Could not find NonLinearresource with supported type."),COMPANION_ADS_GENERAL_ERROR:new ErrorData(600,"General CompanionAds error."),COMPANION_ADS_UNSUITBALE_DIMENSION_ERROR:new ErrorData(601,"Unable to display companion because creative dimensions do not fit within Companion display area (i.e., no available space)."),CONPANION_ADS_DISPALY_ERROR:new ErrorData(602,"Unable to display Required Companion."),COMPANION_ADS_CREATIVE_ERROR:new ErrorData(603,"Unable to fetch CompanionAds/Companion resource."),UNSUPPORTED_COMPANION_ADS_CREATIVE_ERROR:new ErrorData(604,"Could not find Companion resource with supported type."),UNDEFINED_ERROR:new ErrorData(900,"Undefined error."),VPAID_GENERAL_ERROR:new ErrorData(901,"General VPAID error."),MEDIA_FILE_SECURITY_ERROR:new ErrorData(0,"Media file security error")};AdElement.prototype.setSkipOffset=function(e){this._skipoffset=e},AdElement.prototype.getSkipOffset=function(){return this._skipoffset},AdElement.prototype.setLinear=function(e){this._linear=e},AdElement.prototype.getLinear=function(){return this._linear},AdElement.prototype.setNonLinearAds=function(e){this._nonLinearAds=e},AdElement.prototype.getNonLinearAds=function(){return this._nonLinearAds},AdElement.prototype.getMediadFiles=function(){return null!=this._linear?this._linear.MediaFiles:null},AdElement.prototype.getDuration=function(){return null!=this._linear?this._linear.Duration:null},AdElement.prototype.getAdParameters=function(){return null!=this._linear?this._linear.adParameters:null},AdElement.prototype.updateLinearTrackingEventsMap=function(e){if(null!=e&&e.TrackingEvents&&e.TrackingEvents.Tracking)for(var t=e.TrackingEvents.Tracking,i=0;i<t.length;i++){var r=t[i],n=r._event,a=r.__text?r.__text:r.__cdata,o=null;a.indexOf(AdParamConfigReader.pmTrackerDomain)!=-1?(o=this._pmLinearTrackingEventMap[n],null==o&&(o=[],this._pmLinearTrackingEventMap[n]=o)):(o=this._3pLinearTrackingEventMap[n],null==o&&(o=[],this._3pLinearTrackingEventMap[n]=o)),o.push(a)}},AdElement.prototype.updateNonLinearTrackingEventsMap=function(e){if(null!=e&&e.TrackingEvents&&e.TrackingEvents.Tracking)for(var t="[object Array]"===Object.prototype.toString.call(e.TrackingEvents.Tracking)?e.TrackingEvents.Tracking:[e.TrackingEvents.Tracking],i=0;i<t.length;i++){var r=t[i],n=r._event,a=r.__text?r.__text:r.__cdata,o=null;a.indexOf(AdParamConfigReader.pmTrackerDomain)!=-1?(o=this._pmNonLinearTrackingEventMap[n],null==o&&(o=[],this._pmNonLinearTrackingEventMap[n]=o)):(o=this._3pNonLinearTrackingEventMap[n],null==o&&(o=[],this._3pNonLinearTrackingEventMap[n]=o)),o.push(a)}},AdElement.prototype.updateVideoClickArray=function(e){var t=null;if(null!=e.VideoClicks){var i=e.VideoClicks;if(null!=i){var r=i.ClickTracking;if(r)if(Array.isArray(r)){if(null!=r&&r.length>0)for(var n=0;n<r.length;n++){var a=r[n];t=a.__cdata?a.__cdata:a,t.indexOf(AdParamConfigReader.pmTrackerDomain)!=-1?this._pmVideoClickEvents.push(t):this._3pVideoClickEvents.push(t)}}else t=r.hasOwnProperty("__cdata")&&r.__cdata?r.__cdata:r.toString(),t.indexOf(AdParamConfigReader.pmTrackerDomain)!=-1?this._pmVideoClickEvents.push(t):this._3pVideoClickEvents.push(t);var o=i.CustomClicks;if(null!=o&&o.length>0){"[object Array]"!=typeof r&&(o=[o]);for(var n=0;n<o.length;n++){var a=o[n];t=a.__text?a.__text:a.__cdata,t.indexOf(AdParamConfigReader.pmTrackerDomain)!=-1?this._pmVideoClickEvents.push(t):this._3pVideoClickEvents.push(t)}}null!=e.VideoClicks.ClickThrough&&(this._linear.videoClicks.clickThrough=e.VideoClicks.ClickThrough)}}},AdElement.prototype.updateImpressionEventURI=function(e){if(e.length||(e=[e]),null!=e&&e.length>0)for(var t=0;t<e.length;t++){var i=e[t];if("object"==typeof i){var r=i.__text?i.__text:i.__cdata;r.indexOf(AdParamConfigReader.pmTrackerDomain)!=-1?this._pmImpressionEvents.push(r):this._3pImpressionEvents.push(r)}else this._3pImpressionEvents.push(i)}},AdElement.prototype.updateErrorEventURI=function(e){StringUtils.isBlank(e)||(e.indexOf(AdParamConfigReader.pmTrackerDomain)!=-1?this._pmErrorEvents.push(e):this._3pErrorEvents.push(e))},AdElement.prototype.updateCompanionAds=function(e){this._companionAdXML=this._companionAdXML.concat(e)},AdElement.prototype.getLinearClickThruURI=function(){var e=null;if(null!=this._linear){var t=this._linear.videoClicks;if(null!=t){var i=t.clickThrough;null!=i&&(e={url:i,id:i.id,playerHandles:!0})}}return e},AdElement.prototype.getNonLinearClickThruURI=function(e){var t=null;if(null!=this._nonLinearAds){var i=this._nonLinearAds.nonLinears[e].NonLinearClickThrough;t={url:i,id:0,playerHandles:!1}}return t},AdElement.prototype.getLinearTrackingEventURI=function(e){var t=[];return null!=this._pmLinearTrackingEventMap[e]&&(t=t.concat(this._pmLinearTrackingEventMap[e])),null!=this._3pLinearTrackingEventMap[e]&&(t=t.concat(this._3pLinearTrackingEventMap[e])),t},AdElement.prototype.getNonLinearTrackingEventURI=function(e){var t=[];return null!=this._pmNonLinearTrackingEventMap[e]&&(t=t.concat(this._pmNonLinearTrackingEventMap[e])),null!=this._3pNonLinearTrackingEventMap[e]&&(t=t.concat(this._3pNonLinearTrackingEventMap[e])),t},AdElement.prototype.getImpressionEventURI=function(){var e=[];return null!=this._pmImpressionEvents&&(e=e.concat(this._pmImpressionEvents)),null!=this._3pImpressionEvents&&(e=e.concat(this._3pImpressionEvents)),e},AdElement.prototype.getVideoClickEvents=function(){var e=[];return null!=this._pmVideoClickEvents&&(e=e.concat(this._pmVideoClickEvents)),null!=this._3pVideoClickEvents&&(e=e.concat(this._3pVideoClickEvents)),e},AdElement.prototype.getErrorEventURI=function(){var e=[];return null!=this._pmErrorEvents&&(e=e.concat(this._pmErrorEvents)),null!=this._3pErrorEvents&&(e=e.concat(this._3pErrorEvents)),e},AdElement.prototype.isLinearAdFound=function(){var e=!1;try{null!=this._linear&&null!=this._linear.MediaFiles&&GeneralUtils.countObj("MediaFile",this._linear.MediaFiles)>0&&(e=!0)}catch(t){return console.log("Error Message : "+t.message),console.log("Error StackTrace : "+t.getStackTrace()),e}return e},AdElement.prototype.isNonLinearAdFound=function(){var e=!1;try{null!=this._nonLinearAds&&null!=this._nonLinearAds.nonLinears&&this._nonLinearAds.nonLinears.length>0&&(e=!0)}catch(t){return console.log("Error Message : "+t.message),e}return e},AdElement.prototype.isVpaidAd=function(){var e=-1;return this._vpaid._isLinearAd&&null!=this._linear?(e=this.getMediaFileIfVpaid(),e!==-1):null!=this._nonLinearAds?(e=this.getNonLinearCreativeIndex(),this._nonLinearAds.nonLinears[e].apiFramework==Constants.VPAID_STR):void 0},AdElement.prototype.getMediaFileIfVpaid=function(){var e=-1,t=this.getMediadFiles();if("[object Array]"===Object.prototype.toString.call(t.MediaFile)){for(var i=0;i<t.MediaFile.length;i++)if("VPAID"===t.MediaFile[i]._apiFramework&&("application/javascript"===t.MediaFile[i]._type||"text/html"===t.MediaFile[i]._type))return i}else"VPAID"===t.MediaFile._apiFramework&&(e=0);return e},AdElement.prototype.getMediaFileVpaidUrl=function(){var e=this.getMediadFiles();if("[object Array]"===Object.prototype.toString.call(e.MediaFile)){for(var t=0;t<e.MediaFile.length;t++)if("VPAID"===e.MediaFile[t]._apiFramework&&("application/javascript"===e.MediaFile[t]._type||"text/html"===e.MediaFile[t]._type))return e.MediaFile[t]}else if("VPAID"===e.MediaFile._apiFramework)return e.MediaFile},AdElement.prototype.getCompanionsAdsXML=function(){var e=Constants.COMPANION_ADS_START_TOKEN+this._companionAdXML+Constants.COMPANION_ADS_END_TOKEN;return e},AdElement.prototype.getMediaFileIndex=function(){return this._bestMediaFileIndex},AdElement.prototype.scoreAndSetMediaFileIndex=function(){for(var e=0,t=document.createElement("video"),i=this.getMediadFiles(),r="",n=0;n<i.MediaFile.length;n++)if(r=t.canPlayType(i.MediaFile[n]._type),""!==r){e=n;break}this._bestMediaFileIndex=e},AdElement.prototype.getMediaFileURI=function(){var e=this.getMediaFileIndex();if(Array.isArray(this.getMediadFiles().MediaFile))var t=this.getMediadFiles().MediaFile[e].__cdata?this.getMediadFiles().MediaFile[e].__cdata:this.getMediadFiles().MediaFile[e].__text;else var t=this.getMediadFiles().MediaFile.__cdata?this.getMediadFiles().MediaFile.__cdata:this.getMediadFiles().MediaFile.__text;return t},AdElement.prototype.getMediaType=function(){return this.getMediadFiles().MediaFile&&"[object Array]"===Object.prototype.toString.call(this.getMediadFiles().MediaFile)?this.getMediadFiles().MediaFile[this.getMediaFileIndex()]._type:this.getMediadFiles().MediaFile._type},AdElement.prototype.getMediaFileIndex=function(){return this._bestMediaFileIndex},AdElement.prototype.getNonLinearCreative=function(){var e="",t=this.getNonLinearCreativeIndex(),i=this.getNonLinearAds().nonLinears[t];if(i.StaticResource)e=i.StaticResource.__cdata?i.StaticResource.__cdata:i.StaticResource.__text;else if(i.HTMLResource)e=i.HTMLResource.__cdata?i.HTMLResource.__cdata:i.HTMLResource.__text;else{if(!i.IFrameResource)throw new ErrorHandler(ErrorMessage.NON_LINEAR_ADS_CREATIVE_ERROR);e=i.IFrameResource.__cdata?i.IFrameResource.__cdata:i.IFrameResource.__text}return e},AdElement.prototype.getNonLinearCreativeIndex=function(){return this._bestNonLinearCreativeIndex},AdElement.prototype.scoreAndSetNonLinearCreativeIndex=function(){var e=0,t=0,i=this._vpaid.initWidth,r=this._vpaid.initHeight,n=this.getNonLinearAds();if(null==n||null==n.nonLinears||0==n.nonLinears.length)return console.log("<NonLinearAds> not found."),void console.log("PMAK - AdError"+ErrorMessage.NON_LINEAR_ADS_CREATIVE_ERROR.errorMessage);var a=n.nonLinears,o=new Array(a.length);console.log("NonLinear Ads Publisher Parameters (overlayAdDuration, kAdHeight, kAdWidth) :"+AdParamConfigReader.vmaxl+","+AdParamConfigReader.kAdHeight+","+AdParamConfigReader.kAdWidth);for(var s=0;s<a.length;s++){var d=a[s];0!=AdParamConfigReader.kAdWidth&&0!=AdParamConfigReader.kAdHeight&&AdParamConfigReader.kAdHeight==d.height&&AdParamConfigReader.kAdWidth==d.width&&e++,d.height<=r&&d.width<=i&&e++,o[t]=e,t++,e=0}for(var l=0,p=0,s=0;s<a.length;s++)o[s]>l&&(l=o[s],p=s);if(0!=AdParamConfigReader.kAdHeight&&0!=AdParamConfigReader.kAdWidth&&a[p].height>AdParamConfigReader.kAdHeight&&a[p].width>AdParamConfigReader.kAdWidth&&(console.log("Error in displaying non-linear ads. nonlinear width and height are larger than AdUnit width and height."),console.log("PMAK - AdError "+ErrorMessage.ADSIZE_ERROR.errorMessage)),a[p].height>r&&a[p].width>i)throw console.log("Error in displaying non-linear ads. nonlinear width and height are larger than player width and height."),new ErrorHandler(ErrorMessage.NON_LINEAR_ADS_UNSUITBALE_DIMENSION_ERROR);this._bestNonLinearCreativeIndex=p;var h=this.getNonLinearCreative();if(StringUtils.isBlank(h))throw console.log("PMAK - AdError "+ErrorMessage.NON_LINEAR_ADS_CREATIVE_ERROR.errorMessage),new ErrorHandler(ErrorMessage.NON_LINEAR_ADS_CREATIVE_ERROR)},AdElement.prototype.isValidDuration=function(e){if(null!=e){var t=e.toString();if(!StringUtils.isBlank(t)&&t.indexOf("00:00:00")==-1){var i=StringUtils.timecodeToSeconds(e.toString());if(AdParamConfigReader.vminl<=i&&i<=AdParamConfigReader.vmaxl)return!0}}return!1},AdElement.prototype.clearAllMediaFiles=function(){null!=this._linear&&(this._linear.MediaFiles=null),null!=this._nonLinearAds&&(this._nonLinearAds.nonLinears=null)},AdElement.prototype.clearThirdPartyTrackingEvents=function(){this._3pLinearTrackingEventMap={},this._3pNonLinearTrackingEventMap={},this._3pImpressionEvents.splice(0,this._3pImpressionEvents.length),this._3pVideoClickEvents.splice(0,this._3pVideoClickEvents.length),this._3pErrorEvents.splice(0,this._3pErrorEvents.length)};var AdEvent={AD_CLICK_THRU:"AdClickThru",AD_DURATION_CHANGE:"AdDurationChange",AD_ERROR:"AdError",AD_EXPANDED_CHANGE:"AdExpandedChange",AD_IMPRESSION:"AdImpression",AD_INTERACTION:"AdInteraction",AD_LINEAR_CHANGE:"AdLinearChange",AD_LOADED:"AdLoaded",AD_LOG:"AdLog",AD_PAUSED:"AdPaused",AD_PLAYING:"AdPlaying",AD_REMAINING_TIME_CHANGE:"AdRemainingTimeChange",AD_SIZE_CHANGE:"AdSizeChange",AD_SKIPPABLE_STATE_CHANGED:"AdSkippableStateChange",AD_SKIPPED:"AdSkipped",AD_STARTED:"AdStarted",AD_STOPPED:"AdStopped",AD_USER_ACCEPT_INVITATION:"AdUserAcceptInvitation",AD_USER_CLOSE:"AdUserClose",AD_USER_MINIMIZE:"AdUserMinimize",AD_VIDEO_COMPLETE:"AdVideoComplete",AD_VIDEO_FIRST_QUARTILE:"AdVideoFirstQuartile",AD_VIDEO_MIDPOINT:"AdVideoMidpoint",AD_VIDEO_START:"AdVideoStart",AD_VIDEO_THIRD_QUARTILE:"AdVideoThirdQuartile",AD_VOLUME_CHANGE:"AdVolumeChange"},ProtocolPhase={VPAID_LOAD:"VPAID_LOAD",HANDSHAKE:"HANDSHAKE",INIT_AD:"INIT_AD",START_AD:"START_AD",PAUSE_AD:"PAUSE_AD",RESUME_AD:"RESUME_AD",STOP_AD:"STOP_AD"},ResponseType={INVALID_RESP:!1,VALID_RESP:!0},TrackingEventTypes={CREATIVE_VIEW:"creativeView",AD_VIDEO_START:"start",MIDPOINT:"midpoint",FIRST_QUARTILE:"firstQuartile",THIRD_QUARTILE:"thirdQuartile",COMPLETE:"complete",MUTE:"mute",UNMUTE:"unmute",PAUSE:"pause",REWIND:"rewind",RESUME:"resume",FULLSCREEN:"fullscreen",EXPAND:"expand",COLLAPSE:"collapse",ACCEPT_INVITATION:"acceptInvitation",CLOSE:"close",INVALID_EVENT_TYPE:"InvalidEventType",SKIP:"skip",isValidTrackingEventType:function(e){switch(e){case CREATIVE_VIEW:case START:case MIDPOINT:case FIRST_QUARTILE:case THIRD_QUARTILE:case COMPLETE:case MUTE:case UNMUTE:case PAUSE:case REWIND:case RESUME:case FULLSCREEN:case EXPAND:case COLLAPSE:case ACCEPT_INVITATION:case CLOSE:case SKIP:return!0;default:return!1}}};AdTagHandler.prototype.setAdTag=function(e){this._adTag=e},AdTagHandler.prototype.getAdTag=function(){return this._adTag},AdTagHandler.prototype.execute=function(){try{var e;window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.withCredentials=!0,e.onerror=function(e){return function(t){e.onTimedout(),e._vpaid.dispatchAdErrorEvent("Error while making PubMatic AdServer call. Hence, unloading PubMatic VPAID component")}}(this),e.onreadystatechange=function(t){return function(i){4===e.readyState&&200===e.status&&t.onRequestComplete(e.responseText)}}(this),console.log(this.getAdTag()),e.open("GET",this.getAdTag(),!0),e.send(null)}catch(e){this._vpaid.dispatchAdErrorEvent("Error while making PubMatic AdServer call. Hence, unloading PubMatic VPAID component: "+e.message)}},AdTagHandler.prototype.createCORSRequest=function(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(e,t)):i=null,i},AdTagHandler.prototype.executewithcors=function(){var e=this.getAdTag(),t=createCORSRequest("GET",e);return t?(t.onload=function(){this.onRequestComplete(t.responseText)},t.onerror=function(){console.log("Woops, there was an error making the request.")},void t.send()):void console.log("CORS not supported")},AdTagHandler.prototype.onRequestComplete=function(e){try{var t=new AdResponseValidator(e),i=t.validate();if(i!=ResponseType.VALID_RESP)throw console.log("Invalid AdServer Response or VAST validation failed."),console.log("PMAK - AdError "+ErrorMessage.VAST_VALIDATION_ERROR.errorMessage),new ErrorHandler(ErrorMessage.VAST_VALIDATION_ERROR)}catch(e){var r=[];r.push(AdParamConfigReader.getErrorURL(0,0)),"ErrorHandler"==e.constructor.name?e.handleError(r):(console.log("Error Message - "+e.message),
console.log("Error Message - "+ErrorMessage.UNDEFINED_ERROR.errorMessage),new ErrorHandler(ErrorMessage.UNDEFINED_ERROR).handleError(r)),this._vpaid.dispatchAdErrorEvent("Error in AdTagHandler() while handling PubMatic Response...")}for(var n=t.getVAST(),a=t.getCompanionAds(),o=0;o<GeneralUtils.countObj("Ad",n);o++){var s=n.Ad,d=new CreativeHandler(this._creativeHandlers,this._vpaid);try{var l=a[o];d.handleAd(s,l)}catch(e){"ErrorHandler"==e.constructor.name?e.handleError(d.getAdElement().getErrorEventURI()):(console.log("Error Message - "+e.message),new ErrorHandler(ErrorMessage.UNDEFINED_ERROR).handleError(d.getAdElement().getErrorEventURI())),d.handlePassback("")}}},AdTagHandler.prototype.onRedirectResponse=function(e){console.log("Callback called for AdTag request(Redirect)")},AdTagHandler.prototype.onTimedout=function(){var e=[];e.push(AdParamConfigReader.getErrorURL(0,0)),new ErrorHandler(ErrorMessage.VAST_URI_ERROR).handleError(e),this._vpaid.dispatchAdErrorEvent("PubMatic call timedout...")},AdTagHandler.prototype.getCreativeHandlers=function(){return this._creativeHandlers},AdTagHandler.prototype.setCreativeHandlers=function(e){this._creativeHandlers=e},CreativeHandler.prototype.handleAd=function(e,t){var i=!0,r=null,n=null,a=null,o=null,s="InLine";if(e.Wrapper?(s="Wrapper",e=e.Wrapper):e.InLine?(s="InLine",e=e.InLine):e.Skipable&&(e=e.Skipable,s="Skipable"),"Wrapper"==s&&(o=e,i=!1),n=e.Error?e.Error.__cdata?e.Error.__cdata:e.Error:"",r=e.Impression?"object"==typeof e.Impression?e.Impression:[e.Impression]:"",a=e.Creatives?e.Creatives:"",this._isPMADServerResp&&(this.setWiningIds(r),n.indexOf(AdParamConfigReader.pmTrackerDomain)==-1)){var d=AdParamConfigReader.getErrorURL(this._currentWinAdNetworkId,this._currentWinCampaignId);this._adElement.updateErrorEventURI(d)}this._adElement.updateErrorEventURI(n);var l=this.isRedirectedResp(r);if(l&&(this._wrapperCounter=0,this._passbackCounter++,this._adElement.clearThirdPartyTrackingEvents()),this._adElement.updateImpressionEventURI(r),this.updateCreative(a,t),i)try{this.validateAdType(),this._creativeHandlers.push(this),this._pmVPAID.initPMPlayer()}catch(e){e.handleError(this._adElement.getErrorEventURI()),this.handlePassback("")}else this.handleWrapper(o)},CreativeHandler.prototype.handleWrapper=function(e){this._wrapperCounter++;var t=e.VASTAdTagURI.__cdata?e.VASTAdTagURI.__cdata:e.VASTAdTagURI;if(this._isPMADServerResp)return void this.handleCreative(t);if(StringUtils.isBlank(t))return console.log("No VastAdTagURI provided in wrapper..."),new ErrorHandler(ErrorMessage.VAST_URI_ERROR).handleError(this._adElement.getErrorEventURI()),void this.handlePassback("");var i=new URLParser(t),r=i.getDomainName(),n=i.getKAdNetworkId();return AdParamConfigReader.videoAdServerDomain==r&&n>0?(t=AdParamConfigReader.getAdServerCallURI(t),void this.handlePassback(t)):void this.handleCreative(t)},CreativeHandler.prototype.isRedirectedResp=function(e){var t=!1,i=0;this._currentWinAdNetworkId;if(null!=e)for(var r=0;r<e.length;r++){var n=e[r];if("object"==typeof n){var a=n.__text?n.__text:n.__cdata;if(a.indexOf(AdParamConfigReader.pmTrackerDomain)!=-1){var o=new URLParser(a);this._currentWinAdNetworkId=o.getWinAdNetworkId(),this._winCampaignId=o.getWinCampaignId(),this._currentWinAdNetworkId!=Constants.V_CAMPAIGN_NETWORK_ID&&(this._lastWinAdNetworkId=this._currentWinAdNetworkId),this._currentWinCampaignId=o.getWinCampaignId(),0!=this._currentWinCampaignId&&this._winCampaignIds.push(this._currentWinCampaignId),i=o.getDefaultedAdServerId();break}}}return 0!=i&&this._winAdNetworkId==i&&(t=!0),t},CreativeHandler.prototype.handleCreative=function(e){this._wrapperCounter>AdParamConfigReader.wrapperThreshold?(console.log("Wrapper threshold is reached, going for passback if possible.."),new ErrorHandler(ErrorMessage.WRAPPER_LIMIT_ERROR).handleError(this._adElement.getErrorEventURI()),this.handlePassback("")):(this._isPMADServerResp=!1,this.execute(e))},CreativeHandler.prototype.handlePassback=function(e){var t=this._adElement.getLinear();t._skipoffset=void 0,setTimeout(function(e){return function(){e._pmVPAID.removeSkipAt(e.skobj)}}(this),1e3);var i=e;return this._wrapperCounter=0,this._isPMADServerResp=!0,this._passbackCounter+=1,this._adElement.clearThirdPartyTrackingEvents(),this._passbackCounter>AdParamConfigReader.passBackThreshold?void this._pmVPAID.dispatchAdErrorEvent("passback threashold reached"):(0==i.length&&(i=AdParamConfigReader.getAdServerCallURI(""),i=i+Constants.K_AD_NETWORK_CONST+this._currentWinAdNetworkId),0!=this._lastWinAdNetworkId&&(i=i+Constants.LAST_DEF_ADNWK_ID+this._lastWinAdNetworkId),i=i+Constants.DEF_CAMPG_IDS+this._winCampaignIds.join(","),i=i+Constants.OID+this._oid,i=i+"&pbc="+this._passbackCounter,Logger.info("Handling passback !!! Passback URL -> "+i),void this.execute(i))},CreativeHandler.prototype.execute=function(e){try{AdParamConfigReader.pageProtocol===Constants.SECURE_PROTOCOL&&e.startsWith(Constants.UNSECURE_PROTOCOL)&&(e=e.replace(Constants.UNSECURE_PROTOCOL,Constants.SECURE_PROTOCOL));var t;window.XMLHttpRequest?t=new XMLHttpRequest:window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.withCredentials=!0,t.onreadystatechange=function(e){return function(i){4===t.readyState&&200===t.status&&e.onRequestComplete(t.responseText)}}(this),t.onerror=function(t){return function(i){Logger.info("Error making XHR request in CreativeHandler. URL -> "+e),new ErrorHandler(ErrorMessage.MEDIA_FILE_NOT_FOUND_ERROR).handleError(t._adElement.getErrorEventURI()),t.handlePassback("")}}(this),t.open("GET",e,!0),t.send(null)}catch(e){this._vpaid.dispatchAdErrorEvent("Error in CreativeHandler. "+e.message)}},CreativeHandler.prototype.onRequestComplete=function(e){try{var t=new AdResponseValidator(e),i=t.validate();if(i!=ResponseType.VALID_RESP)return void(this._isPMADServerResp?(new ErrorHandler(ErrorMessage.VAST_URI_ERROR).handleError(this._adElement.getErrorEventURI()),this._pmVPAID.dispatchAdErrorEvent("Empty/Invalid response from PubMatic")):this.handlePassback(""));var r=t.getVAST(),n=r.Ad,a=t._companionAds[0];this.handleAd(n,a)}catch(e){"ErrorHandler"==e.constructor.name?e.handleError(this._adElement.getErrorEventURI()):console.log("Error Message : "+e.message),this.handlePassback("")}},CreativeHandler.prototype.onRedirectResponse=function(e){console.log("In onRedirectResponse: redirect url: "+e),e=AdParamConfigReader.getAdServerCallURI(e),this.handlePassback(e)},CreativeHandler.prototype.onTimedout=function(){return new ErrorHandler(ErrorMessage.VAST_URI_ERROR).handleError(this._adElement.getErrorEventURI()),this._isPMADServerResp?void this._pmVPAID.dispatchAdErrorEvent("No Ads from PubMatic due to timeout..."):void this.handlePassback("")},CreativeHandler.prototype.updateCreative=function(e,t){e=e.Creative,e.length||(e=[e]);for(var i=0;i<e.length;i++){var r=e[i];if(null!=r){var n=r;console.log("creativeObj is Linear/NonLinear"),this._linear=null,n.Linear?this.updateLinear(n.Linear):n.NonLinearAds&&this.updateNonLinearAds(n.NonLinearAds)}}this._adElement.updateCompanionAds(t),this._pmVPAID.setAdElement(this._adElement)},CreativeHandler.prototype.updateLinear=function(e){if(null!=e){var t=this._adElement.getLinear();null==t&&(this._adElement.setLinear(e),t=e),null!=e.Duration&&(t.Duration=e.Duration),null!=e._skipoffset&&(t._skipoffset=e._skipoffset),null!=e.MediaFiles&&0!=GeneralUtils.countObj("MediaFile",e.MediaFiles)&&(t.MediaFiles=e.MediaFiles),this._adElement.updateLinearTrackingEventsMap(e),this._adElement.updateVideoClickArray(e),t.adParameters=e.adParameters,this._pmVPAID.setAdElement(this._adElement)}},CreativeHandler.prototype.updateNonLinearAds=function(e){if(null!=e){var t=this._adElement.getNonLinearAds();null==t&&(this._adElement.setNonLinearAds(e),t=e),this._adElement.updateNonLinearTrackingEventsMap(e),null!=e.NonLinear&&(t.nonLinears=e.NonLinear),this._pmVPAID.setAdElement(this._adElement)}},CreativeHandler.prototype.validateAdType=function(){var e=this._adElement.isLinearAdFound(),t=this._adElement.isNonLinearAdFound();switch(AdParamConfigReader.vtype){case 0:this._pmVPAID.setIsLinearAd(e),e?this._adElement.scoreAndSetMediaFileIndex():this._adElement.scoreAndSetNonLinearCreativeIndex();break;case 1:if(!e)throw console.log("Linear Ad Not Found."),new ErrorHandler(ErrorMessage.LINEARITY_ERROR);this._pmVPAID.setIsLinearAd(!0),this._adElement.scoreAndSetMediaFileIndex();break;case 2:if(!t)throw console.log("NonLinear Ad Not Found."),new ErrorHandler(ErrorMessage.LINEARITY_ERROR);this._pmVPAID.setIsLinearAd(!1),this._adElement.scoreAndSetNonLinearCreativeIndex();break;default:throw console.log("Invalid value for vtype: "+AdParamConfigReader.vtype),new ErrorHandler(ErrorMessage.LINEARITY_ERROR)}this._pmVPAID.setAdElement(this._adElement)},CreativeHandler.prototype.getLinearTrackingEventMap=function(e){for(var t={},i=e.TrackingEvents.Tracking,r=0;r<i.length;r++){var n=i[r],a=n._event,o=n.__text?n.__text:n.__cdata,s=t[a];null==s&&(s=[],t[a]=s),s.push(o)}return t},CreativeHandler.prototype.getNonLinearTrackingEventsMap=function(e){for(var t={},i=e.TrackingEvents.Tracking,r=0;r<i.length;r++){var n=i[r],a=n._event,o=n.__text?n.__text:n.__cdata,s=t[a];null==s&&(s=[],t[a]=s),s.push(o)}return t},CreativeHandler.prototype.setWiningIds=function(e){if(null!=e){e.length||(e=[e]);for(var t=0;t<e.length;t++){var i=e[t];if("object"==typeof i){var r=i.__text?i.__text:i.__cdata;if(r.indexOf(AdParamConfigReader.pmTrackerDomain)!=-1){var n=new URLParser(r);this._currentWinAdNetworkId=n.getWinAdNetworkId(),this._winCampaignId=n.getWinCampaignId(),this._currentWinAdNetworkId!=Constants.V_CAMPAIGN_NETWORK_ID&&(this._lastWinAdNetworkId=this._currentWinAdNetworkId),this._currentWinCampaignId=n.getWinCampaignId(),0!=this._currentWinCampaignId&&this._winCampaignIds.push(this._currentWinCampaignId),StringUtils.isBlank(this._oid)&&(this._oid=n.getOID());break}}}}},CreativeHandler.prototype.getAdElement=function(){return this._adElement},ErrorHandler.prototype.handleError=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];r=r.replace("[ERRORCODE]",this._errorData.errorCode),r=r.replace("[errorcode]",this._errorData.errorCode),t.push(r)}EventHandler.prototype.execute(t)},EventHandler.prototype.execute=function(e){for(var t=0;t<e.length;t++){var i=e[t];"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0==this.indexOf(e)}),i=i.__cdata?i.__cdata:i;try{this.FireURL(i)}catch(e){console.log("Error while executing an event: "+e.message)}}},EventHandler.prototype.FireURL=function(e){var t=document.getElementById("trackImg");if(!t){var t=document.createElement("img");t.id="trackImg",t.src=""}t.src=e,Logger.info("Executing - "+e)},_JSInterfaceHandler.prototype.startUserSynchUp=function(){var e=AdParamConfigReader.showAdJSURI+"#PIX&it=2&kdntuid=1&np=0&p="+AdParamConfigReader.pubId+"&s="+AdParamConfigReader.siteId+"&a="+AdParamConfigReader.adId;console.log("SYNC UP URI "+e);var t=window.document.createElement("IFRAME");t.src=e,t.width="0",t.height="0",t.scrolling="no",t.frameborder="0",t.style="height:0px;width:0px;display:none;",t.vspace="0",t.hspace="0",t.marginwidth="0",t.marginheight="0",t.allowtransparency="true",window.document.body.appendChild(t),console.log("UserSynchup is started..."),this.addShowadScriptToPage()},_JSInterfaceHandler.prototype.addShowadScriptToPage=function(){var e=window.document.createElement("SCRIPT");window.document.body.appendChild(e),e.onload=function(){_JSInterfaceHandler.prototype.showAdvReady()},e.src=AdParamConfigReader.showAdJSURI},_JSInterfaceHandler.prototype.showAdvReady=function(){var e={pubId:AdParamConfigReader.pubId,siteId:AdParamConfigReader.siteId,adId:AdParamConfigReader.adId,playerDomId:""},t=PubMatic.sendParamToVPAID(e);console.log("##-----------------------------------##"),console.log("Parameters recevied from JS :"),console.log(t),console.log("##-----------------------------------##"),this.getDataFromJS(t)},_JSInterfaceHandler.prototype.getDataFromJS=function(e){if(Logger.debug("getDataFromJS(): Collecting Data from showad.js: "+e),e&&AdParamConfigReader){var t=e;StringUtils.isBlank(t.SAVersion)||(AdParamConfigReader.SAVersion=t.SAVersion),StringUtils.isBlank(t.inIframe)||(AdParamConfigReader.inIframe=t.inIframe),StringUtils.isBlank(t.kdntuid)||(AdParamConfigReader.kdntuid=t.kdntuid),StringUtils.isBlank(t.kltstamp)||(AdParamConfigReader.kltstamp=t.kltstamp),StringUtils.isBlank(t.pageURL)||(AdParamConfigReader.pageURL=t.pageURL),StringUtils.isBlank(t.ranreq)||(AdParamConfigReader.ranreq=t.ranreq),StringUtils.isBlank(t.screenResolution)||(AdParamConfigReader.screenResolution=t.screenResolution),StringUtils.isBlank(t.sec)||(AdParamConfigReader.sec=t.sec),StringUtils.isBlank(t.timezone)||(AdParamConfigReader.timezone=t.timezone),StringUtils.isBlank(t.coppa)||("false"==t.coppa?AdParamConfigReader.coppa=!1:AdParamConfigReader.coppa=!0),StringUtils.isBlank(t.at_payload)||(AdParamConfigReader.at_payload=t.at_payload),StringUtils.isBlank(t.plyH)||(AdParamConfigReader.playerHeight=parseInt(t.plyH)),StringUtils.isBlank(t.plyW)||(AdParamConfigReader.playerWidth=parseInt(t.plyW)),StringUtils.isBlank(t.winH)||(AdParamConfigReader.winHeight=parseInt(t.winH)),StringUtils.isBlank(t.winW)||(AdParamConfigReader.winWidth=parseInt(t.winW)),StringUtils.isBlank(t.refURL)||(AdParamConfigReader.vwndurl=t.refURL),StringUtils.isBlank(t.winURL)||(AdParamConfigReader.vwndref=t.winURL),StringUtils.isBlank(t.depth)||(AdParamConfigReader.depth=parseInt(t.depth)),StringUtils.isBlank(t.plocx)||(AdParamConfigReader.plocX=parseInt(t.plocx)),StringUtils.isBlank(t.plocy)||(AdParamConfigReader.plocY=parseInt(t.plocy)),StringUtils.isBlank(t.pos)||(AdParamConfigReader.adVisibility=parseInt(t.pos))}},_AdParamConfigReader.prototype.initConfig=function(e,t,i){switch(this.kltstamp="",this.timezone=1,this.pubId=0,this.siteId=0,this.adId=0,this.adtagtype=0,this.vadFmt=0,this.vminl=0,this.vmaxl=0,this.vtype=0,this.kAdHeight=0,this.kAdWidth=0,this.SAVersion=2,this.inIframe=1,this.js=1,this.kdntuid=1,this.kltstamp="",this.pageURL="",this.ranreq=0,this.screenResolution="-1x-1",this.sec=1,this.timezone=1,this.coppa,this.at_payload="",this.vxloc=0,this.vyloc=0,this.vminbtr=0,this.vmaxbtr=0,this.vcom=0,this.vfmt=null,this.vcomw=0,this.vcomh=0,this.vapi=0,this.vcont=null,this.vplay=null,this.vpos=0,this.playerHeight=0,this.playerWidth=0,this.winHeight=0,this.winWidth=0,this.adHeight=i,this.adWidth=t,this.winURL="",this.refURL="",this.depth=-1,this.vdomId="",this.debugLevel=0,this.videoAdServerDomain,this.videoAdServerURI,this.showAdJSDomain,this.showAdJSURI,this.pmTrackerDomain,this.pmTrackerURI,this.isPixelFlag=!0,this.passBackThreshold=3,this.wrapperThreshold=3,this.pageProtocol=Constants.UNSECURE_PROTOCOL,this.HTTP_REQUEST_TIMEOUT=3e3,this.SHOWAD_LOAD_TIMEOUT=2e3,this.VPAID_PROTOCOL_TIMEOUT=1e4,this.MEDIA_STREAM_TIMEOUT=1e4,this.DEFAULT_THRESHOLD=3,this.DEFAULT_VID_DOMAIN="vid.pubmatic.com",this.DEFAULT_ADS_PATH="/AdServer/AdServerServlet?",this.DEFAULT_SHOWADS_DOMAIN="ads.pubmatic.com",this.DEFAULT_SHOWADS_PATH="/AdServer/js/showad.js?",this.DEFAULT_TRACKER_DOMAIN="aktrack.pubmatic.com",this.retrieveQueryParamsFromCallingURL=function(e){for(var t,i,r={},n="",a=document.getElementsByTagName("script"),o=0;o<a.length;o+=1)if(-1!==a[o].src.indexOf(e)){n=a[o].src;break}Logger.info("PM VPAID FILE URL - "+n);var s=n;n.indexOf("?")>0&&(n=n.slice(n.indexOf("?")+1)),t=n.split("&");for(var d=0;d<t.length;d+=1)if(t[d].length>0&&(i=t[d].split("="),i[0]!==s&&i[0].length>0))if(1===i.length)r[i[0]]=null;else if(2===i.length)r[i[0]]=decodeURIComponent(i[1]);else{r[i[0]]="";for(var l=1;l<i.length;l+=1)r[i[0]]+=decodeURIComponent(i[l]),l<i.length-1&&(r[i[0]]+="=")}return r},this.getParameterByName=function(e){for(var t={},i=e.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");t[n[0]]=n[1]}return t},this.createQueryString=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i+"="+e[i]);return t.join("&")},this.adTagVariables=this.retrieveQueryParamsFromCallingURL(Constants.PM_VPAID_FILE_NAME),"vfmt"in this.adTagVariables&&delete this.adTagVariables.vfmt,this.adTagQueryString=this.createQueryString(this.adTagVariables),this.adTagVariables.pubId&&""!=this.adTagVariables.pubId&&(this.pubId=parseInt(this.adTagVariables.pubId)),this.adTagVariables.siteId&&""!=this.adTagVariables.siteId&&(this.siteId=parseInt(this.adTagVariables.siteId)),this.adTagVariables.adId&&""!=this.adTagVariables.adId&&(this.adId=parseInt(this.adTagVariables.adId)),this.adTagVariables.adtagtype&&""!=this.adTagVariables.adtagtype&&(this.adtagtype=parseInt(this.adTagVariables.adtagtype)),this.adTagVariables.adtype&&""!=this.adTagVariables.adtype&&(this.adtagtype=parseInt(this.adTagVariables.adtype)),this.adTagVariables.vadFmt&&""!=this.adTagVariables.vadFmt&&(this.vadFmt=parseInt(this.adTagVariables.vadFmt)),this.adTagVariables.vminl&&""!=this.adTagVariables.vminl&&(this.vminl=parseInt(this.adTagVariables.vminl)),this.adTagVariables.vmaxl&&""!=this.adTagVariables.vmaxl&&(this.vmaxl=parseInt(this.adTagVariables.vmaxl)),(StringUtils.isBlank(this.pubId)||0==this.pubId||StringUtils.isBlank(this.siteId)||0==this.siteId||StringUtils.isBlank(this.adId)||0==this.adId||StringUtils.isBlank(this.adtagtype)||0==this.adtagtype)&&(Logger.error("Mandatory Parameters missing in adserver request: PubId- "+this.pubId+", SiteId- "+this.siteId+", AdID- "+this.adId+", adTagType / AdType- "+this.adtagtype),that.dispatchAdErrorEvent("Mandatory Parameters missing in adserver request: PubId- "+this.pubId+", SiteId- "+this.siteId+", AdID- "+this.adId+", adTagType / AdType- "+this.adtagtype)),this.adTagVariables.vminbtr&&""!=this.adTagVariables.vminbtr&&(this.vminbtr=parseInt(this.adTagVariables.vminbtr),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_MIN_BTR+Constants.EQUAL_OP+this.vminbtr),this.adTagVariables.vmaxbtr&&""!=this.adTagVariables.vmaxbtr&&(this.vmaxbtr=parseInt(this.adTagVariables.vmaxbtr),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_MAX_BTR+Constants.EQUAL_OP+this.vmaxbtr),this.adTagVariables.kAdHeight&&""!=this.adTagVariables.kAdHeight&&(this.kAdHeight=parseInt(this.adTagVariables.kAdHeight),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.K_AD_HEIGHT+Constants.EQUAL_OP+this.kAdHeight),this.adTagVariables.kAdWidth&&""!=this.adTagVariables.kAdWidth&&(this.kAdWidth=parseInt(this.adTagVariables.kAdWidth),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.K_AD_WIDTH+Constants.EQUAL_OP+this.kAdWidth),this.adTagVariables.vxloc&&""!=this.adTagVariables.vxloc&&(this.vxloc=parseInt(this.adTagVariables.vxloc),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_X_LOC+Constants.EQUAL_OP+this.vxloc),this.adTagVariables.vyloc&&""!=this.adTagVariables.vyloc&&(this.vyloc=parseInt(this.adTagVariables.vyloc),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_Y_LOC+Constants.EQUAL_OP+this.vyloc),this.adTagVariables.vcom&&""!=this.adTagVariables.vcom&&(this.vcom=parseInt(this.adTagVariables.vcom),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_COM+Constants.EQUAL_OP+this.vcom),this.adTagVariables.vcomh&&""!=this.adTagVariables.vcomh&&(this.vcomh=parseInt(this.adTagVariables.vcomh),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_COMH+Constants.EQUAL_OP+this.vcomh),this.adTagVariables.vcomw&&""!=this.adTagVariables.vcomw&&(this.vcomw=parseInt(this.adTagVariables.vcomw),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_COMW+Constants.EQUAL_OP+this.vcomw),this.adTagVariables.vplay&&""!=this.adTagVariables.vplay&&(this.vplay=String(this.adTagVariables.vplay),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_PLAY+Constants.EQUAL_OP+this.vplay),this.adTagVariables.vcont&&""!=this.adTagVariables.vcont&&(this.vcont=String(this.adTagVariables.vcont),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_CONT+Constants.EQUAL_OP+this.vcont),this.adTagVariables.vapi&&""!=this.adTagVariables.vapi&&(this.vapi=parseInt(this.adTagVariables.vapi),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_API+Constants.EQUAL_OP+this.vapi),this.adTagVariables.vtype&&""!=this.adTagVariables.vtype&&(this.vtype=parseInt(this.adTagVariables.vtype),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_TYPE+Constants.EQUAL_OP+this.vtype),this.adTagVariables.vpos&&""!=this.adTagVariables.vpos&&(this.vpos=parseInt(this.adTagVariables.vpos),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.V_POS+Constants.EQUAL_OP+this.vpos),this.adTagVariables.vdomId&&""!=this.adTagVariables.vdomId&&(this.vdomId=this.adTagVariables.vdomId),this.adTagVariables.coppa&&""!=this.adTagVariables.coppa&&(this.coppa=this.adTagVariables.coppa,this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.COPPA+Constants.EQUAL_OP+this.coppa),this.adTagVariables.pageURL&&""!=this.adTagVariables.pageURL&&isNaN(this.adTagVariables.pageURL)&&(this.pageURL=decodeURIComponent(this.adTagVariables.pageURL),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.PAGE_URL+Constants.EQUAL_OP+this.pageURL),this.adTagVariables.vwndref&&""!=this.adTagVariables.vwndref&&isNaN(this.adTagVariables.vwndref)&&(this.refURL=decodeURIComponent(this.adTagVariables.vwndref),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.PAGE_URL+Constants.EQUAL_OP+this.refURL),this.adTagVariables.vwndurl&&""!=this.adTagVariables.vwndurl&&isNaN(this.adTagVariables.vwndurl)&&(this.winURL=decodeURIComponent(this.adTagVariables.vwndurl),this.pubRequestParams=this.pubRequestParams+Constants.AMP_OP+Constants.PAGE_URL+Constants.EQUAL_OP+this.winURL),StringUtils.isBlank(this.adTagVariables.adVisibility)||(this.adVisibility=parseInt(this.adTagVariables.adVisibility)),StringUtils.isBlank(this.adTagVariables.adPosition)||(this.adPosition=this.adTagVariables.adPosition),StringUtils.isBlank(this.adTagVariables.sec)||(this.sec=parseInt(this.adTagVariables.sec)),StringUtils.isBlank(this.adTagVariables.csa)||(this.csa=parseInt(this.adTagVariables.csa)),this.pubId){case 27349:csa=1}this.debugLevel=""!=this.adTagVariables.debug&&this.adTagVariables.debug?parseInt(this.adTagVariables.debug):0,this.HTTP_REQUEST_TIMEOUT=StringUtils.isBlank(this.adTagVariables.ht)?this.HTTP_REQUEST_TIMEOUT:parseInt(this.adTagVariables.ht),this.SHOWAD_LOAD_TIMEOUT=StringUtils.isBlank(this.adTagVariables.slt)?this.SHOWAD_LOAD_TIMEOUT:parseInt(this.adTagVariables.slt),this.VPAID_PROTOCOL_TIMEOUT=StringUtils.isBlank(this.adTagVariables.vpt)?this.VPAID_PROTOCOL_TIMEOUT:parseInt(this.adTagVariables.vpt);try{window.location.protocol.indexOf("http")!==-1?this.pageProtocol=window.location.protocol:window.top.location.protocol&&window.top.location.protocol.indexOf("http")!==-1?this.pageProtocol=window.top.location.protocol:this.pageProtocol=Constants.UNSECURE_PROTOCOL}catch(e){Logger.info("Error in accessing parent location.protocol. Error message -> "+e.message),this.pageProtocol=Constants.UNSECURE_PROTOCOL}try{this.passBackThreshold=this.DEFAULT_THRESHOLD,this.wrapperThreshold=this.DEFAULT_THRESHOLD,this.videoAdServerDomain=this.DEFAULT_VID_DOMAIN,this.videoAdServerURI=this.pageProtocol+"//"+this.videoAdServerDomain+this.DEFAULT_ADS_PATH,this.showAdJSDomain=this.DEFAULT_SHOWADS_DOMAIN,this.showAdJSURI=this.pageProtocol+"//"+this.showAdJSDomain+this.DEFAULT_SHOWADS_PATH,this.pmTrackerDomain=this.DEFAULT_TRACKER_DOMAIN,this.pmTrackerURI=this.pageProtocol+"//"+this.pmTrackerDomain,this.isPixelFlag=!0,Logger.info("Configuration Parameters - Passback Threshold - "+this.passBackThreshold+"\n Wrapper Threshold - "+this.wrapperThreshold+"\n VideoAdServer URI - "+this.videoAdServerURI+"\n ShowAdJS URI - "+this.showAdJSURI+"\n PM Tracker URI - "+this.pmTrackerURI+"\n Pixel Flag - "+this.isPixelFlag)}catch(e){return Logger.error("Error in initConfig():Error while reading config Params. Error Message -> \n "+e.message),!1}return!0},_AdParamConfigReader.prototype.getErrorURL=function(e,t){console.log("_winAdNetworkId, _winCampaignId"),console.log(e,t);var i;try{var r=new Date,n=Math.round(r.valueOf()/1e3);i="http://"+AdParamConfigReader.DEFAULT_TRACKER_DOMAIN+"/track?operId=7&p="+AdParamConfigReader.pubId+"&s="+AdParamConfigReader.siteId+"&a="+AdParamConfigReader.adId+"&ts="+n+"&wa="+e+"&er=[ERRORCODE]",e==Constants.V_CAMPAIGN_NETWORK_ID&&(i=i.concat("&wc="+winCampaignId))}catch(e){Logger.warn("Error inside getErrorURL()... Error Message: "+e.message)}return i},_AdParamConfigReader.prototype.getJsParameters=function(){var e=new Date;""==this.kltstamp&&(this.kltstamp=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),this.kltstamp=encodeURIComponent(this.kltstamp)),1==this.timezone&&(this.timezone=e.getTimezoneOffset()/60*-1),this.getRandomNumber=function(){return Math.random()};var t=0==AdParamConfigReader.playerWidth?"":Constants.AMP_OP+Constants.PLAYER_WIDTH+Constants.EQUAL_OP+AdParamConfigReader.playerWidth,i=0==AdParamConfigReader.playerHeight?"":Constants.AMP_OP+Constants.PLAYER_WIDTH+Constants.EQUAL_OP+AdParamConfigReader.playerWidth,r=0==AdParamConfigReader.winHeight?"":Constants.AMP_OP+Constants.WIN_HEIGHT+Constants.EQUAL_OP+AdParamConfigReader.winHeight,n=0==AdParamConfigReader.winWidth?"":Constants.AMP_OP+Constants.WIN_WIDTH+Constants.EQUAL_OP+AdParamConfigReader.winWidth,a=0==AdParamConfigReader.adHeight?"":Constants.AMP_OP+Constants.AD_HEIGHT+Constants.EQUAL_OP+AdParamConfigReader.adHeight,o=0==AdParamConfigReader.adWidth?"":Constants.AMP_OP+Constants.AD_WIDTH+Constants.EQUAL_OP+AdParamConfigReader.adWidth,s="";AdParamConfigReader.vwndurl&&isNaN(AdParamConfigReader.vwndurl)&&(s=""==AdParamConfigReader.vwndurl?"":Constants.AMP_OP+Constants.WIN_URL+Constants.EQUAL_OP+AdParamConfigReader.vwndurl);var d="";AdParamConfigReader.vwndref&&isNaN(AdParamConfigReader.vwndref)&&(d=""==AdParamConfigReader.vwndref?"":Constants.AMP_OP+Constants.REF_URL+Constants.EQUAL_OP+AdParamConfigReader.vwndref);var l=""==AdParamConfigReader.kdntuid?"":Constants.AMP_OP+Constants.K_DNT_UID+Constants.EQUAL_OP+AdParamConfigReader.kdntuid,p="-1x-1"==AdParamConfigReader.screenResolution?"":Constants.AMP_OP+Constants.SCREEN_RESOLUTION+Constants.EQUAL_OP+AdParamConfigReader.screenResolution,h="";AdParamConfigReader.pageURL&&isNaN(AdParamConfigReader.pageURL)&&(h=""==AdParamConfigReader.pageURL?"":Constants.AMP_OP+Constants.PAGE_URL+Constants.EQUAL_OP+AdParamConfigReader.pageURL);var A=""==AdParamConfigReader.js?"":Constants.AMP_OP+Constants.JS+Constants.EQUAL_OP+AdParamConfigReader.js,_=""==AdParamConfigReader.depth?"":Constants.AMP_OP+Constants.DEPTH+Constants.EQUAL_OP+AdParamConfigReader.depth,c=Constants.AMP_OP+Constants.SA_VERSION+Constants.EQUAL_OP+AdParamConfigReader.SAVersion+Constants.AMP_OP+Constants.IN_I_FRAME+Constants.EQUAL_OP+AdParamConfigReader.inIframe+A+_+Constants.AMP_OP+Constants.K_L_TSTAMP+Constants.EQUAL_OP+AdParamConfigReader.kltstamp+h+Constants.AMP_OP+Constants.RAN_REQ+Constants.EQUAL_OP+this.getRandomNumber()+Constants.AMP_OP+Constants.TIMEZONE+Constants.EQUAL_OP+AdParamConfigReader.timezone+p+l+t+i+r+n+a+o+s+d;return c=c+Constants.AMP_OP+Constants.V_FMT+Constants.EQUAL_OP+"1+5+6+7",-1!=this.depth&&(c+=Constants.AMP_OP+Constants.DEPTH+Constants.EQUAL_OP+this.depth),0!=this.sec&&(c+=Constants.AMP_OP+Constants.SEC+Constants.EQUAL_OP+this.sec),this.coppa&&(c+=Constants.AMP_OP+Constants.COPPA+Constants.EQUAL_OP+this.coppa),""!=this.at_payload&&(c+=Constants.AMP_OP+Constants.AT_PAYLOAD+Constants.EQUAL_OP+this.at_payload),c},_AdParamConfigReader.prototype.getQueuryStringForAdServerCall=function(){var e=this.getParameterByName(this.adTagQueryString);("pageURL"in e&&!isNaN(e.pageURL)||"pageURL"in e&&"undefined"==e.pageURL)&&delete e.pageURL,("vwndurl"in e&&!isNaN(e.vwndurl)||"vwndurl"in e&&"undefined"==e.vwndurl)&&delete e.vwndurl,("vwndref"in e&&!isNaN(e.vwndref)||"vwndref"in e&&"undefined"==e.vwndref)&&delete e.vwndref,"ged"in e&&delete e.ged,"ged"in e&&delete e.ged;var t=this.getJsParameters();"&"!=t.charAt(0)&&"?"!=t.charAt(0)||(t=t.substring(1));var i=this.getParameterByName(t);"ged"in i&&delete i.ged,void 0==i[0]&&delete i[0],"pageURL"in e&&"pageURL"in i&&delete e.pageURL,"winURL"in e&&"winURL"in i&&delete e.winURL,"refURL"in e&&"refURL"in i&&delete e.refURL;var r=this.createQueryString(e);if("&=undefined"==r.substring(r.length-11)||"?=undefined"==r.substring(r.length-11)){var n=r.length-11;r=r.substring(0,n)}var a=this.createQueryString(i);if("&=undefined"==a.substring(a.length-11)||"?=undefined"==a.substring(a.length-11)){var n=a.length-11;a=a.substring(0,n)}if("pageURL"in e||"pageURL"in i||(e.pageURL=""),"sec"in i)try{delete r.sec}catch(e){console.log(e)}var o=r+"&"+a;return o},_AdParamConfigReader.prototype.getAdServerCallURI=function(){var e=this.videoAdServerURI+this.getQueuryStringForAdServerCall()+"&vc=2";return e},AdResponseValidator.prototype.validate=function(){var e=ResponseType.INVALID_RESP;if(!StringUtils.isBlank(this._respData))try{var t=new xmlToJson;try{this.vast=t.xml_str2json(this._respData),this.vast=this.vast.VAST}catch(e){}}catch(e){throw console.log("Exception while parsing reponse. Error Message -> "+e.message),new ErrorHandler(ErrorMessage.VAST_PARSING_ERROR)}return null!=this.vast&&null!=this.vast.Ad&&GeneralUtils.countObj("Ad",this.vast)>0&&(e=ResponseType.VALID_RESP,this.parseCompanionAds()),e},AdResponseValidator.prototype.parseCompanionAds=function(){for(var e,t,i=this._respData.split(this.AD_END_TOKEN),r=0;r<i.length-1;r++)e=i[r].indexOf(this.COMPANION_ADS_START_TOKEN_PARTIAL),-1!=e?(e=i[r].indexOf(">",e+this.COMPANION_ADS_START_TOKEN_PARTIAL.length)+1,t=i[r].lastIndexOf(Constants.COMPANION_ADS_END_TOKEN),this._companionAds[r]=i[r].substring(e,t)):this._companionAds[r]=Constants.EMPTY_STRING},AdResponseValidator.prototype.getVAST=function(){return this.vast},AdResponseValidator.prototype.getCompanionAds=function(){return this._companionAds},AdResponseValidator.prototype.CompanionAds=function(){return this._companionAds},_Logger.prototype.initialize=function(e){null==this._logDispatcher&&(this._logDispatcher=e)},_Logger.prototype.setDebugLevel=function(e){this.debugLevel=e},_Logger.prototype.log=function(e){this.debugLevel>=5&&this.consoleLog("log",e)},_Logger.prototype.debug=function(e){this.debugLevel>=4&&this.consoleLog("debug",e)},_Logger.prototype.info=function(e){this.consoleLog("info",e)},_Logger.prototype.warn=function(e){this.consoleLog("warn",e)},_Logger.prototype.error=function(e){this.consoleLog("warn",e)},_Logger.prototype.consoleLog=function(e,t){window.console?window.console[e](this.logPrefix+e+":"+t):this.dispatchLog(this.logPrefix+e+":"+t)},_Logger.prototype.dispatchLog=function(e){if(!(this.debugLevel<=0)){var t={message:e},i=this.subscribeCallbacks[AdEvent.AD_LOG];"undefined"!=typeof i&&i.aCallback.call(i.aContext,t)}},URLParser.prototype.init=function(e){if(""!=e&&e){var t=e.split("/");this._domainName=t[2];var i=e.indexOf("?");if(i>0){var r=e.substring(i+1);this._urlVariables=new URLVariables(r)}i=e.indexOf(":"),this._protocol=i!=-1?e.substring(0,i):null,i=e.lastIndexOf("/"),this._filepathWithProtocol=i!=-1?e.substring(0,i+1):null;var n=e.lastIndexOf(".");this._filenameNoExtention=i!=-1&&n!=-1&&i<n?e.substring(i+1,n):null}},URLParser.prototype.getDomainName=function(){return this._domainName},URLParser.prototype.getWinAdNetworkId=function(){var e=0,t=this._urlVariables.adServerId;return""!=t&&(e=parseInt(t)),e},URLParser.prototype.getWinCampaignId=function(){var e=0,t=this._urlVariables.campaignId;return""!=t&&(e=parseInt(t)),e},URLParser.prototype.getDefaultedAdServerId=function(){var e=0,t=this._urlVariables.defaultedAdServerId;return""!=t&&(e=parseInt(t)),e},URLParser.prototype.getKAdNetworkId=function(){var e=0,t=this._urlVariables.kadNetwork;return""!=t&&(e=parseInt(t)),
e},URLParser.prototype.getOID=function(){var e=this._urlVariables.oid;return e},URLParser.prototype.getUrl=function(){return this._url},URLParser.prototype.getProtocol=function(){return this._protocol},URLParser.prototype.getFilepathWithProtocol=function(){return this._filepathWithProtocol},URLParser.prototype.getFilenameNoExtention=function(){return this._filenameNoExtention},URLVariables.prototype.getParameterByName=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=i.exec(e);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))},Loader.prototype.load=function(e,t){var i=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=e,r.onreadystatechange=t,r.onload=t,i.appendChild(r)},Loader.prototype.ImageExist=function(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){return!1}return 404!=t.status},Loader.prototype.preloadImg=function(e,t){var i=document.createElement("img");i.id=t,i.onload=this.onOverLayLoadComplete(),i.src=e},_MediaClient.prototype.onMetaData=function(e){console.log("metadata: duration="+e.duration+" width="+e.width+" height="+e.height+" framerate="+e.framerate)},_MediaClient.prototype.onCuePoint=function(e){console.log("cuepoint: time="+e.time+" name="+e.name+" type="+e.type)},OverlayAdPlayer.prototype.creativeExist=function(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){return!1}return 404!=t.status},OverlayAdPlayer.prototype.play=function(e){Logger.info("Playing NonLinear ad..."+AdParamConfigReader.vmaxl),this._pmVPAID.setAdDuration(AdParamConfigReader.vmaxl);var t=function(e){return function(){e.onNonLinearAdTimmerComplete()}}(this);this._nonLinearAdTimmer=setTimeout(t,1e3*AdParamConfigReader.vmaxl);try{var i=document.createElement("img");i.id="test",i.addEventListener("click",function(e){return function(){PMVideoPlayer.prototype.nonLinearClickThruAd.call(e)}}(this),!1),this.positionNonLinearAd();var r={x:this._loader.x,y:this._loader.y};i.src=e,this._pmVPAID.addChildAt(i,0,r);var n=parseInt(this._loader.x)+parseInt(this._nonLinear._width);r={x:n,y:this._loader.y},this._pmVPAID.addChildAt(this._closeButton,1,r),this._pmVPAID.buttonMode=!0,this._pmVPAID.executeImpressionEvent(),this._pmVPAID.executeAdcreativeEvent(),this._pmVPAID.executeAdStartedEvent()}catch(e){throw new ErrorHandler(ErrorMessage.NON_LINEAR_ADS_GENERAL_ERROR)}},OverlayAdPlayer.prototype.imageExist=function(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){return!1}return 404!=t.status},OverlayAdPlayer.prototype.positionNonLinearAd=function(){var e=AdParamConfigReader.vxloc,t=AdParamConfigReader.vyloc;return 0!=e||0!=t?(this._loader.x=e,this._loader.y=t,void Logger.debug("Done with setting position of NonLinear.")):(this.positionAtMiddleBottom(this._nonLinear._width,this._nonLinear._height),void Logger.debug("Done with setting position of NonLinear."))},OverlayAdPlayer.prototype.positionAtMiddleBottom=function(e,t){0==e?this._loader.x=0:this._loader.x=(this._initWidth-e)/2,0==t?this._loader.y=0:this._loader.y=this._initHeight-t},OverlayAdPlayer.prototype.expand=function(){0!=this._nonLinear.expandedHeight&&0!=this._nonLinear.expandedWidth?(this._loader.height=this._nonLinear.expandedHeight,this._loader.width=this._nonLinear.expandedWidth):(this._loader.height=_initHeight,this._loader.width=_initWidth),this.positionAtMiddleBottom(this._loader.width,this._loader.height),this.positionCloseButton(this._loader.width),this._pmVPAID.adExpanded=!0,this._pmVPAID.dispatchAdEvent(AdEvent.AD_EXPANDED_CHANGE)},OverlayAdPlayer.prototype.collapse=function(){this._loader.height=this._nonLinear.height,this._loader.width=this._nonLinear.width,this.positionNonLinearAd(),this.positionCloseButton(this._loader.width),this._pmVPAID.adExpanded=!1,this._pmVPAID.dispatchAdEvent(AdEvent.AD_EXPANDED_CHANGE)},OverlayAdPlayer.prototype.resize=function(e,t,i){this._initWidth=e,this._initHeight=t,this.positionNonLinearAd(),this.positionCloseButton(this._nonLinear.width),this._pmVPAID.dispatchAdEvent(AdEvent.AD_SIZE_CHANGE)},OverlayAdPlayer.prototype.positionCloseButton=function(e){this._closeButton.x=this._loader.x+e-70,this._closeButton.y=this._loader.y+1},OverlayAdPlayer.prototype.loadOverlay=function(){var e=this._adElement.getNonLinearCreative(),t=e;if(!OverlayAdPlayer.prototype.imageExist(t))throw new ErrorHandler(ErrorMessage.NON_LINEAR_ADS_GENERAL_ERROR);this.play(t)},OverlayAdPlayer.prototype.onCloseAd=function(e){this._pmVPAID.dispatchAdEvent(AdEvent.AD_USER_CLOSE),this.onNonLinearAdTimmerComplete(e)},OverlayAdPlayer.prototype.onNonLinearAdTimmerComplete=function(e){Logger.debug("Inside OverlayAdPlayer:onNonLinearAdTimmerComplete()"),clearTimeout(this._nonLinearAdTimmer),this._pmVPAID.removeChildAt(1),this._pmVPAID.removeChildAt(0),this._pmVPAID.stopAd()};var globalPlayer=null;PMVideoPlayer.prototype.initPMPlayer=function(e,t,i,r,n,a,o){Logger.info("Inside PMVideoPlayer initPMPlayer : "),Logger.info("PMVideoPlayer initPMPlayer  - initWidth :"+e),Logger.info("PMVideoPlayer initPMPlayer  - initHeight :"+t),Logger.info("PMVideoPlayer initPMPlayer  - viewMode :"+i),Logger.info("PMVideoPlayer initPMPlayer  - desiredBitrate :"+r),Logger.info("PMVideoPlayer initPMPlayer  - creativeData :"+n),Logger.info("PMVideoPlayer initPMPlayer  - environmentVars :"+a),Logger.info("PMVideoPlayer initPMPlayer  - adElement :"+o),this._initHeight=t,this._initWidth=e,this._viewMode=i,this._desiredBitrate=r,this._creativeData=n,this._environmentVars=a,this._adElement=o,this._slot=a.slot,this._isLinearAd&&(this._video.height=t,this._video.width=e,this.setTotalAdDurationInSec(),this._urlParser=new URLParser(this._adElement.getMediaFileURI()),this._fileType=this._adElement.getMediaType()),this._pmVPAID.dispatchAdLoadedEvent(),Logger.debug("VideoPlayer attributes Initialized .")},PMVideoPlayer.prototype.isTypePlayable=function(e){return!!this._pmVPAID._videoSlot.canPlayType(e)},PMVideoPlayer.prototype.UrlExists=function(e){return!0},PMVideoPlayer.prototype.startPMPlayerTimer=function(){Logger.info("Inside startPMPlayerTimer : _pmPlayerHeartBeat start");var e=function(e){return function(){e.onPMPlayerHeartBeatEvent()}}(this);this._pmPlayerHeartBeat=setInterval(e,500)},PMVideoPlayer.prototype.resetPMPlayer=function(){Logger.info("Inside resetPMPlayer: _pmPlayerHeartBeat stop/clear"),clearInterval(this._pmPlayerHeartBeat)},PMVideoPlayer.prototype.onSkipAd=function(){this._pmVPAID.executeAdSkipEvent(),this._protocolTimer.stop()},PMVideoPlayer.prototype.addSkipable=function(e){this._skipButton=null;var t=function(e){return function(t){t.preventDefault(),t.stopImmediatePropagation(),e.onSkipAd()}}(this),i=function(e){return function(e){e.preventDefault(),e.stopImmediatePropagation()}}(this),r=e;if(this._skipButton=new CommandButton("Skip ad >>"),this._skipButton.addEventListener?this._skipButton.addEventListener("click",i,!1):this._skipButton.attachEvent("onclick",this.onSkipAd),pot={x:"0",y:"50"},r>0){this.skobj||(this.skobj=this._pmVPAID.addSkipAt(this._skipButton,"_pmSkip",pot),this.skobj.style.display="none");var n=setInterval(function(e){return function(){document.getElementById("_pmSkip").innerHTML="You can skip this ad in "+r,e.skobj.style.display="block",console.log(r),0==r&&(clearInterval(n),document.getElementById("_pmSkip").innerHTML="Skip Ad >>",e._skipButton.removeEventListener("click",i,!1),e._skipButton.addEventListener("click",t,!1)),e.isPaused||r--}}(this),1e3)}else this.skobj=this._pmVPAID.addSkipAt(this._skipButton,"_pmSkip",pot),document.getElementById("_pmSkip").innerHTML="Skip Ad >>",this._skipButton.removeEventListener("click",i,!1),this._skipButton.addEventListener("click",t,!1)},PMVideoPlayer.prototype.start=function(){if(Logger.info("Inside PMVideoPlayer:start()"),this._isLinearAd)try{Logger.debug("PMVideoPlayer playing linear ad..."),this._pmVPAID.resetAdDuration();var e=this._pmVPAID._adElement._linear._skipoffset,t=this._pmVPAID._totalAdDuration;if(e){var i,r=e.split(":");r.length>1?i=parseInt(r[0])*(60*parseInt(r[1]))+parseInt(r[2]):(r=e.split("%"),r.length>1&&(i=Math.round(r[0]*t/100))),i<t&&this.addSkipable(i)}!function(e){e._slot.addEventListener("click",function(t){t.preventDefault(),t.stopImmediatePropagation(),e.linearClickThruAd()})}(this),this.playStream()}catch(e){this._pmVPAID.removeSkipAt(this.skobj),Logger.debug("PMVideoPlayer - Error when, playing linear ad..."),new ErrorHandler(ErrorMessage.LINEAR_ADS_GENERAL_ERROR).handleError(this._adElement.getErrorEventURI()),this.handleMediaError(ErrorMessage.LINEAR_ADS_GENERAL_ERROR)}else{Logger.debug("PMVideoPlayer playing nonlinear ad..."),this._overlayPlayer=new OverlayAdPlayer(this._initWidth,this._initHeight,this._adElement,this._pmVPAID),this.addOverlayAdListeners();try{this._overlayPlayer.loadOverlay()}catch(e){Logger.debug("PMVideoPlayer - Error when, playing Non-linear ad..."),new ErrorHandler(ErrorMessage.NON_LINEAR_ADS_GENERAL_ERROR).handleError(this._adElement.getErrorEventURI()),this.handleMediaError(ErrorMessage.NON_LINEAR_ADS_GENERAL_ERROR)}}},PMVideoPlayer.prototype.addOverlayAdListeners=function(){},PMVideoPlayer.prototype.removeOverlayAdListeners=function(){},PMVideoPlayer.prototype.play=function(){this._video.removeEventListener("loadstart",this.play,!1),this._video.play(),this.startPMPlayerTimer(),Logger.info("Playing Ad !!!"),this._pmVPAID.dispatchAdEvent(AdEvent.AD_STARTED)},PMVideoPlayer.prototype.videoPlayError=function(e){var t="Error occured during video playback !!! ";try{var i=this._video.error.code||0;switch(i){case this._video.error.MEDIA_ERR_ABORTED:t+="Creative timeout error.",new ErrorHandler(ErrorMessage.TIMEOUT_MEDIA_FILE_ERROR).handleError(this._adElement.getErrorEventURI());break;case this._video.error.MEDIA_ERR_NETWORK:t+="Creative file not found.",new ErrorHandler(ErrorMessage.MEDIA_FILE_NOT_FOUND_ERROR).handleError(this._adElement.getErrorEventURI());break;case this._video.error.MEDIA_ERR_DECODE:t+="Creative decoding error.",new ErrorHandler(ErrorMessage.UNSUPPORTED_MEDIA_FILE_ERROR).handleError(this._adElement.getErrorEventURI());case this._video.error.MEDIA_ERR_SRC_NOT_SUPPORTED:t+="Creative Not supported.",new ErrorHandler(ErrorMessage.UNSUPPORTED_MEDIA_FILE_ERROR).handleError(this._adElement.getErrorEventURI())}}catch(e){new ErrorHandler(ErrorMessage.MEDIA_FILE_GENERAL_ERROR).handleError(this._adElement.getErrorEventURI())}finally{this._pmVPAID._myInstance.dispatchAdErrorEvent(t)}},PMVideoPlayer.prototype.playStream=function(){Logger.debug("Inside PMVideoPlayer:playStream()");var e=this.UrlExists(this._urlParser.getUrl()),t=this.isTypePlayable(this._fileType);if(e&&t){this._video.src=this._urlParser.getUrl();var i="loadstart";window.addEventListener?(this._video.addEventListener("error",function(e){return function(t){e.videoPlayError(t)}}(this),!1),GeneralUtils.detectDevice("ios")?this._video.addEventListener("canplay",function(e){return function(t){e.play()}}(this),!1):this._video.addEventListener(i,function(e){return function(t){e.play()}}(this),!1)):window.attachEvent&&(this._video.attachEvent("error",function(e){return function(t){e.videoPlayError(t)}}(this),!1),this._video.attachEvent("loadstart",function(e){return function(t){e.play()}}(this),!1)),this._video.load()}else this._pmVPAID.removeSkipAt(this.skobj),new ErrorHandler(ErrorMessage.MEDIA_FILE_NOT_FOUND_ERROR).handleError(this._adElement.getErrorEventURI()),this.handleMediaError(ErrorMessage.MEDIA_FILE_NOT_FOUND_ERROR)},PMVideoPlayer.prototype.pause=function(){if(Logger.info("Inside PMVideoPlayer:pause()"),this._isLinearAd){Logger.debug("Pausing Video Ad : time: "+this._video.currentTime);try{this.isPaused=!0,this._video.pause(),this._pmVPAID.executeTrackingEvent(TrackingEventTypes.PAUSE)}catch(e){Logger.debug("Error in pausing the Linear video ad:"+e.message)}}},PMVideoPlayer.prototype.resume=function(){if(Logger.info("Inside PMVideoPlayer:resume()"),this._isLinearAd){Logger.debug("Resuming Video Ad : time: "+this._video.currentTime);try{this._video.play(),this.isPaused=!1,this._pmVPAID.executeTrackingEvent(TrackingEventTypes.RESUME)}catch(e){Logger.warn("Error in resuming the Linear video ad:"+e.message)}}},PMVideoPlayer.prototype.stop=function(){if(Logger.info("Inside PMVideoPlayer:stop()"),this._isLinearAd){Logger.debug("Stoping Ad : time: "+this._video.currentTime);try{this._video.pause(),this._video.ended=!0,this._pmVPAID.dispatchAdEvent(AdEvent.AD_STOPPED)}catch(e){Logger.warn("Error in stopping linear video ad:"+e.message)}}},PMVideoPlayer.prototype.expand=function(){Logger.info("Inside PMVideoPlayer:expand()"),this._isLinearAd||this._overlayPlayer.expand()},PMVideoPlayer.prototype.collapse=function(){Logger.info("Inside PMVideoPlayer:collapse()"),this._isLinearAd||this._overlayPlayer.collapse()},PMVideoPlayer.prototype.resize=function(e,t,i){return Logger.info("Inside PMVideoPlayer:resize()"),this._isLinearAd?(i==Constants.VIEW_MODE_FULLSCREEN&&(e=this._pmVPAID.stage.width,t=this._pmVPAID.stage.height),this._video.height=t,this._video.width=e,this._pmVPAID.initHeight=t,this._pmVPAID.initWidth=e,void this._pmVPAID.dispatchAdEvent(AdEvent.AD_SIZE_CHANGE)):void this._overlayPlayer.resize(e,t,i)},PMVideoPlayer.prototype.changeVolume=function(e){Logger.info("Inside PMVideoPlayer:changeVolume()");try{this._video.volume=e,this._pmVPAID.dispatchAdEvent(AdEvent.AD_VOLUME_CHANGE)}catch(e){Logger.warn("Exception while changing video ad volume: "+e.message)}},PMVideoPlayer.prototype.getAdCompanions=function(){Logger.info("Inside PMVideoPlayer:getAdCompanions()");var e;try{e=this._adElement.getCompanionsAdsXML()}catch(e){new ErrorHandler(ErrorMessage.COMPANION_ADS_GENERAL_ERROR).handleError(this._adElement.getErrorEventURI())}return e},PMVideoPlayer.prototype.getTotalAdDuration=function(){return Logger.info("Inside PMVideoPlayer:getTotalAdDuration() - returning with _totalAdDuration -> "+this._totalAdDuration),this._totalAdDuration},PMVideoPlayer.prototype.getRemainingAdDuration=function(){Logger.info("Inside PMVideoPlayer:getRemainingAdDuration()");var e=0;return this._isLinearAd&&null!=this._video.currentTime&&(e=this._totalAdDuration-this._video.currentTime),e},PMVideoPlayer.prototype.setTotalAdDurationInSec=function(){Logger.info("Inside PMVideoPlayer:setTotalAdDurationInSec()");var e,t=this._adElement.getDuration();if(null==t||void 0===t)t={},t.seconds=AdParamConfigReader.vminl%60,t.minutes=AdParamConfigReader.vminl/60%60,Logger.debug("Setting custom adDuration <-> vminl param ... adDuration: "+t),e=60*t.minutes+t.seconds;else{var i=t.split(":");e=parseInt(i[0])*(60*parseInt(i[1]))+parseInt(i[2])}Logger.info("Inside PMVideoPlayer:setTotalAdDurationInSec() - value setting to this._totalAdDuration + "+e),this._totalAdDuration=e},PMVideoPlayer.prototype.onPMPlayerHeartBeatEvent=function(){try{var e=this.getTrackingEventByVideoProgressStatus(Math.round(this._video.currentTime));TrackingEventTypes.INVALID_EVENT_TYPE!==e&&(this._pmVPAID.executeTrackingEvent(e),TrackingEventTypes.COMPLETE===e&&this.stop())}catch(e){Logger.warn("Error in onPMPlayerHeartBeatEvent() of PMVideoPlayer: "+e.message)}},PMVideoPlayer.prototype.errorHandler=function(e){"AsyncErrorEvent"==e.constructor.name?Logger.warn("Inside PMVideoPlayer:errorHandler() - Error: "+e):this.handleMediaError(ErrorMessage.MEDIA_FILE_NOT_FOUND_ERROR)},PMVideoPlayer.prototype.onOverLayLoadComplete=function(e){Logger.info("NonLinear load completed....");try{this._overlayPlayer.play()}catch(e){"ErrorHandler"==e.constructor.name?e.handleError(this._adElement.getErrorEventURI()):Logger.error("Error in statusEventHandler() of PMVideoPlayer: "+e.message),this.handleMediaError(ErrorMessage.NON_LINEAR_ADS_GENERAL_ERROR)}},PMVideoPlayer.prototype.handleMediaError=function(e){Logger.error(e.errorMessage),this._pmVPAID.handleErrorPassback()},PMVideoPlayer.prototype.getTrackingEventByVideoProgressStatus=function(e){var t=this._totalAdDuration,i=TrackingEventTypes.INVALID_EVENT_TYPE;return this._startQuartileFlag&&e>=1&&e<1*t/4?(this._pmVPAID.executeImpressionEvent(),this._pmVPAID.executeAdcreativeEvent(),this._pmVPAID.executeAdStartedEvent(),this._startQuartileFlag=!1):this._firstQuartileFlag&&e>=1*t/4&&e<1*t/2?(i=TrackingEventTypes.FIRST_QUARTILE,this._firstQuartileFlag=!1):this._midpointFlag&&e>=1*t/2&&e<3*t/4?(i=TrackingEventTypes.MIDPOINT,this._midpointFlag=!1):this._thirdQuartileFlag&&e>=3*t/4&&e<t?(i=TrackingEventTypes.THIRD_QUARTILE,this._thirdQuartileFlag=!1):this._completeFlag&&e>=t&&(i=TrackingEventTypes.COMPLETE,this._completeFlag=!1),i},PMVideoPlayer.prototype.linearClickThruAd=function(){this._pmVPAID.linearClickThruAd()},PMVideoPlayer.prototype.nonLinearClickThruAd=function(e){var t=this._adElement.getNonLinearCreativeIndex();this._pmVPAID.nonLinearClickThruAd(t)},PMVideoPlayer.prototype.resetPMPlayer=function(){this._pmVPAID.resetPMPlayer()};var AdParamConfigReader=new _AdParamConfigReader,Logger=new _Logger,JSInterfaceHandler=new _JSInterfaceHandler;LinearAd=function(){this._slot=null,this._videoSlot=null,this.vpaidJSON=null,this.AdElements=[],this._adElement=null,this.__initWidth=0,this.__initHeight=0,this.__viewMode="Normal",this.__desiredBitrate=0,this.__creativeData="",this.__environmentVars="",this._isLinearAd=!0,this._isVPAIDAd=!1,this._isAdLoadedEventDispached=!1,this._totalAdDuration=0,this._remainingTime=0,this._currentAdIndex=0,this._currentAdElement,this._currentVpaidPhase=null,this._heartBeatTimer=null,this._plyInfo="",this._adTagHandler=null,this._showAdJSLoadTimmer=null,this._myInstance=null,this._pmPlayer=null,this.__initWidth=0,this.__initHeight=0,this.__viewMode="Normal",this.__desiredBitrate=0,this.__creativeData="",this.__environmentVars="",this._adExpanded=!1,this._volume=0,this._myInstance=this,this.mouseEnabled=!0,this._isAdLoadedEventDispached=!1,this._currentAdIndex=0,Logger.initialize(this)},LinearAd.prototype.setAdElement=function(e){this._adElement=e},LinearAd.prototype.getAdElement=function(){return this._adElement},LinearAd.prototype.removeSkipAt=function(e){e&&this._slot.removeChild(e)},LinearAd.prototype.addSkipAt=function(e,t,i){var r=document.getElementById(t);return r&&this._slot.removeChild(r),e.id=t,i&&i.x&&i.y&&(e.style.right=i.x+"px",e.style.bottom=i.y+"px",e.style.position="absolute"),this._slot.appendChild(e),e},LinearAd.prototype.addChildAt=function(e,t,i){e.id="pm-"+t,i&&i.x&&i.y&&(e.style.left=i.x+"px",e.style.top=i.y+"px",e.style.position="absolute"),this._slot.appendChild(e)},LinearAd.prototype.removeChildAt=function(e){var t=document.getElementById("pm-"+e);this._slot.removeChild(t)},LinearAd.prototype.addChild=function(e,t,i){var r=document.createElement("iframe"),n=999*Math.random()+1;return r.id="adloaderframe-"+n,r.onload=function(){var n=r.contentWindow.document.createElement("script");n.src=e,n.onload=function(){var e=r.contentWindow.getVPAIDAd;if(e&&"function"==typeof e){var n=r.contentWindow.getVPAIDAd();i._tpVPAIDAd=n,t.call(i,n)}},r.contentWindow.document.body.appendChild(n)},document.body.appendChild(r),r},LinearAd.prototype.getAdIcons=function(){console.log("getAdIcons")},LinearAd.prototype.getAdWidth=function(){return console.log("getAdWidth"),this.__initWidth},LinearAd.prototype.getAdHeight=function(){return console.log("getAdHeight"),this.____initHeight},LinearAd.prototype.handshakeVersion=function(e){return console.log("handshakeVersion, playerVPAIDVersion -> "+e),Logger.setDebugLevel(1),Logger.info("VPAIDMain:handshakeVersion() - PM AD MANAGER RELEASE VERSION: "+Constants.PM_AD_MGR_RELEASE_VERSION),Logger.info("VPAIDMain:handshakeVersion() - Player Version:"+e),2},LinearAd.prototype.initAd=function(e,t,i,r,n,a){console.log("into initAd method"),this.__initWidth=e,this.__initHeight=t,this.__viewMode=i,this.__desiredBitrate=r,this.__creativeData=n,this.__environmentVars=a,this._slot=a.slot,this._videoSlot=a.videoSlot;var o=n;AdParamConfigReader.initConfig(o,e,t)&&(AdParamConfigReader.adWidth=this.__initWidth,AdParamConfigReader.adHeight=this.__initHeight,Logger.setDebugLevel(AdParamConfigReader.debugLevel),Logger.debug("Query String:"+AdParamConfigReader.adTagQueryString),Logger.debug("ConfigParamString:"+AdParamConfigReader.configParameterString),AdParamConfigReader.isPixelFlag&&JSInterfaceHandler.startUserSynchUp(),this._showAdJSLoadTimmer=setTimeout(this.onshowAdJSLoadTimmerComplete,AdParamConfigReader.SHOWAD_LOAD_TIMEOUT),1!=AdParamConfigReader.csa&&this.makeAdServerCall(),1==AdParamConfigReader.csa&&(Logger.info("Deferring Ad Serving call into startAd Phase for pubId: "+AdParamConfigReader.pubId),this.dispatchAdLoadedEvent()))},LinearAd.prototype.startAd=function(){Logger.info("Inside VPAIDMain:startAd()"),this._currentVpaidPhase=ProtocolPhase.START_AD,1==AdParamConfigReader.csa?this.makeAdServerCall():this._pmPlayer.start()},LinearAd.prototype.getAdLinear=function(){return this._isLinearAd},LinearAd.prototype.getAdRemainingTime=function(){return this._remainingTime},LinearAd.prototype.getAdDuration=function(){return this._totalAdDuration},LinearAd.prototype.getAdExpanded=function(){return this._adExpanded},LinearAd.prototype.getAdVolume=function(){return Logger.info("volume - "+this._volume),this._volume},LinearAd.prototype.setAdVolume=function(e){Logger.info("VPAIDMain:adVolume() - volume: "+e),null!=this._pmPlayer&&(this._volume=e,this._pmPlayer.changeVolume(e))},LinearAd.prototype.pauseAd=function(){Logger.info("Inside VPAIDMain:pauseAd()"),this._currentVpaidPhase=ProtocolPhase.PAUSE_AD,null!=this._pmPlayer&&this._pmPlayer.pause()},LinearAd.prototype.resumeAd=function(){Logger.info("Inside VPAIDMain:resumeAd()"),this._currentVpaidPhase=ProtocolPhase.RESUME_AD,null!=this._pmPlayer&&this._pmPlayer.resume()},LinearAd.prototype.stopAd=function(){Logger.info("Inside VPAIDMain:stopAd()"),this._currentVpaidPhase=ProtocolPhase.STOP_AD,null!=this._pmPlayer&&this._pmPlayer.stop()},LinearAd.prototype.companions=function(){return alert("called"),Logger.info("Inside VPAIDMain:adCompanions()"),null!=this._pmPlayer?this._pmPlayer.getAdCompanions():(Logger.warn("VPAIDMain:adCompanions() - PMPlayer object is not initialized yet."),"")},LinearAd.prototype.resizeAd=function(e,t,i){Logger.info("Inside VPAIDMain:resizeAd()"),null!=this._pmPlayer&&this._pmPlayer.resize(e,t,i)},LinearAd.prototype.expandAd=function(){Logger.info("Inside VPAIDMain:expandAd()"),null!=this._pmPlayer&&this._pmPlayer.expand()},LinearAd.prototype.collapseAd=function(){Logger.info("Inside VPAIDMain:collapseAd()"),null!=this._pmPlayer&&this._pmPlayer.collapse()},LinearAd.prototype.stopShowAdJSLoaderTimer=function(){this._showAdJSLoadTimmer.running&&clearTimeout(this._showAdJSLoadTimmer)},LinearAd.prototype.onshowAdJSLoadTimmerComplete=function(e){1!=AdParamConfigReader.csa},LinearAd.prototype.executeTrackingEvent=function(e){Logger.info("Executing Tracking Event: "+e);var t=null;t=this._isLinearAd?this._currentAdElement.getLinearTrackingEventURI(e):this._currentAdElement.getNonLinearTrackingEventURI(e),null!=t&&EventHandler.prototype.execute(t);var i=this.getAdEventTypeFromTrackingEventType(e);StringUtils.isBlank(i)||this.dispatchAdEvent(i)},LinearAd.prototype.executeVideoClickEvents=function(){var e=this._currentAdElement.getVideoClickEvents();Logger.info("Executing ClickTracking event"),EventHandler.prototype.execute(e)},LinearAd.prototype.executeImpressionEvent=function(){Logger.info("Executing IMPRESSION event");var e=this._currentAdElement.getImpressionEventURI();EventHandler.prototype.execute(e),this.dispatchAdEvent(AdEvent.AD_IMPRESSION)},LinearAd.prototype.executeAdcreativeEvent=function(){this.executeTrackingEvent(TrackingEventTypes.CREATIVE_VIEW)},LinearAd.prototype.executeAdSkipEvent=function(){this.executeTrackingEvent(TrackingEventTypes.SKIP)},LinearAd.prototype.executeAdStartedEvent=function(){this.executeTrackingEvent(TrackingEventTypes.AD_VIDEO_START)},LinearAd.prototype.executeAdStopedEvent=function(){this.executeTrackingEvent(TrackingEventTypes.CLOSE)},LinearAd.prototype.dispatchAdEvent=function(e){var t=this.subscribeCallbacks[e];"undefined"!=typeof t&&t.aCallback.call(t.aContext)},LinearAd.prototype.linearClickThruAd=function(){try{var e=this._currentAdElement.getLinearClickThruURI();if(window.open(e.url),null!=e){var t=this.subscribeCallbacks[AdEvent.AD_CLICK_THRU];"undefined"!=typeof t&&t.aCallback.call(t.aContext,e)}this.executeVideoClickEvents()}catch(e){Logger.warn("Error in dispatching AdClickThru event : "+e.message)}},LinearAd.prototype.nonLinearClickThruAd=function(e){try{var t=this._currentAdElement.getNonLinearClickThruURI(e);if(null!=t){var i=this.subscribeCallbacks[AdEvent.AD_CLICK_THRU];"undefined"!=typeof i&&i.aCallback.call(i.aContext,t)}window.open(t.url)}catch(e){Logger.warn("Error in dispatching AdClickThru event : "+e.message)}},LinearAd.prototype.makeAdServerCall=function(e){Logger.debug("Making call to AdServer..."),setTimeout(function(t){return function(){var i;try{e?(t._adTagHandler.setAdTag(e),i=e):i=AdParamConfigReader.getAdServerCallURI(),t._adTagHandler=t._adTagHandler||new AdTagHandler(i,t.getInstance()),t._adTagHandler.execute()}catch(e){Logger.error("Internal Error While Making AdServer Call: "+e.message),"ErrorHandler"==e.constructor.name?e.handleError():t.dispatchAdErrorEvent("Error in making AdServer call: "+e.message)}}}(this),2e3)},LinearAd.prototype.initPMPlayer=function(){if(this._currentAdElement=this._adTagHandler.getCreativeHandlers()[this._currentAdIndex].getAdElement(),this._isVPAIDAd=this._currentAdElement.isVpaidAd(),this._isVPAIDAd){console.log("Third Party VPAID !!!");var e=this._currentAdElement.getMediaFileVpaidUrl();this._pmPlayer=new PMVpaidPlayer(this._isLinearAd,this._videoSlot,this,e.__cdata)}else this._pmPlayer=new PMVideoPlayer(this._isLinearAd,this._videoSlot,this);this._pmPlayer.initPMPlayer(this.__initWidth,this.__initHeight,this.__viewMode,this.__desiredBitrate,this.__creativeData,this.__environmentVars,this._currentAdElement)},LinearAd.prototype.resetPMPlayer=function(){this._pmPlayer.resetPMPlayer(),this._pmPlayer=null},LinearAd.prototype.handleErrorPassback=function(){if(this._currentAdIndex>0)return void this.dispatchAdEvent(AdEvent.AD_STOPPED);this._currentAdElement.clearAllMediaFiles();var e=this._adTagHandler.getCreativeHandlers()[this._currentAdIndex];switch(this._currentVpaidPhase){case ProtocolPhase.HANDSHAKE:case ProtocolPhase.INIT_AD:case ProtocolPhase.START_AD:Logger.info("Going for passback during phase "+this._currentVpaidPhase+" failure"),e.handlePassback("");break;default:return void this.dispatchAdErrorEvent("Error @Phase: "+this._currentVpaidPhase)}},LinearAd.prototype.dispatchAdErrorEvent=function(e){Logger.error(e);var t=this.subscribeCallbacks[AdEvent.AD_ERROR];"undefined"!=typeof t&&t.aCallback.call(t.aContext,e)},LinearAd.prototype.dispatchAdLoadedEvent=function(){this._isAdLoadedEventDispached?this._pmPlayer.start():(Logger.info("Done with PMPlayer initialization. Now dispatching AD_LOADED Event."),this.dispatchAdEvent(AdEvent.AD_LOADED),this._isAdLoadedEventDispached=!0)},LinearAd.prototype.dispatchAdDurationChangeEvent=function(){this.dispatchAdEvent(AdEvent.AD_DURATION_CHANGE)},LinearAd.prototype.resetAdDuration=function(){try{if(null!=this._pmPlayer){var e=this._pmPlayer.getTotalAdDuration();this.setAdDuration(e)}}catch(e){Logger.warn("Error in resetAdDuration(): "+e.message)}},LinearAd.prototype.setAdDuration=function(e){this._totalAdDuration=e,this._remainingTime=e,this.dispatchAdDurationChangeEvent()},LinearAd.prototype.increamentCurrentAdIndex=function(){this._currentAdIndex=this._currentAdIndex+1},setInterval(LinearAd.prototype.heartBeat,1e3),LinearAd.prototype.heartBeat=function(){if(null!=this._pmPlayer)try{this._remainingTime=this._pmPlayer.getRemainingAdDuration(),console.log(this._remainingTime)}catch(e){Logger.warn("Error in heartBeat(): "+e.message)}},LinearAd.prototype.getAdEventTypeFromTrackingEventType=function(e){var t=null;switch(e){case TrackingEventTypes.CREATIVE_VIEW:break;case TrackingEventTypes.AD_VIDEO_START:t=AdEvent.AD_VIDEO_START;break;case TrackingEventTypes.FIRST_QUARTILE:t=AdEvent.AD_VIDEO_FIRST_QUARTILE;break;case TrackingEventTypes.MIDPOINT:t=AdEvent.AD_VIDEO_MIDPOINT;break;case TrackingEventTypes.THIRD_QUARTILE:t=AdEvent.AD_VIDEO_THIRD_QUARTILE;break;case TrackingEventTypes.COMPLETE:t=AdEvent.AD_VIDEO_COMPLETE;break;case TrackingEventTypes.PAUSE:t=AdEvent.AD_PAUSED;break;case TrackingEventTypes.RESUME:t=AdEvent.AD_PLAYING;break;case TrackingEventTypes.SKIP:t=AdEvent.AD_SKIPPED}return t},LinearAd.prototype.setIsLinearAd=function(e){this._isLinearAd=e},LinearAd.prototype.getInstance=function(){return this._myInstance},LinearAd.prototype.getVPAID=function(){return this},LinearAd.prototype.getCurrentVpaidPhase=function(){return this._currentVpaidPhase},LinearAd.prototype.setVPAIDAd=function(e){this._isVPAIDAd=e},LinearAd.prototype.getVPAIDAd=function(){return this._isVPAIDAd},LinearAd.prototype.getInitWidth=function(){return this.__initWidth},LinearAd.prototype.getInitHeight=function(){return this.__initHeight},LinearAd.prototype.getAdWidth=function(){return this.__initWidth},LinearAd.prototype.getAdHeight=function(){return this.__initHeight},LinearAd.prototype.getAdTagHandler=function(){return this._adTagHandler},LinearAd.prototype.getCurrentAdIndex=function(){return this._currentAdIndex},LinearAd.prototype.getCurrentAdElement=function(){return this._currentAdElement},LinearAd.prototype.setInitWidth=function(e){this.__initWidth=e},LinearAd.prototype.initHeight=function(e){this.__initHeight=e},LinearAd.prototype.setAdExpanded=function(e){this._adExpanded=e},LinearAd.prototype.getAdSkippableState=function(e){console.log("getAdSkippableState")},LinearAd.prototype.skipAd=function(){console.log("skipAd")},LinearAd.prototype.subscribeCallbacks=[],LinearAd.prototype.subscribe=function(e,t,i){this.subscribeCallbacks[t]={aCallback:e,aContext:i}},LinearAd.prototype.unsubscribe=function(e){this.subscribeCallbacks.length=0,console.log("Component unsubscribed !!!")},getVPAIDAd=function(){return new LinearAd},Timer.prototype.start=function(){this._timer=setTimeout(this.onCompleteFunc,this.delay),this.running=!0},Timer.prototype.stop=function(){this.running=!1,clearTimeout(this._timer)},PMVpaidPlayer.prototype.initPMPlayer=function(e,t,i,r,n,a,o){if(console.log("Initializing PM VPAID player ..."),!this._isLinearAd){var s=o.getNonLinearCreativeIndex();n=o.getNonLinearAds().NonLinears[s]._adParameters}this._initHeight=t,this._initWidth=e,this._viewMode=i,this._desiredBitrate=r,this._creativeData=n,this._environmentVars=a,this._adElement=o,this._loader=null,this.loadVPAID()},PMVpaidPlayer.prototype.loadVPAID=function(){console.log("loadVPAID(): Loading 3rd party VPAID media: "+this._tpVPAIDAdUrl),this._loader=new Loader,this.addLoaderListeners(),this._protocolTimer.start(),console.log("PMVpaidPlayer:loadVPAID() - loading 3rp-party vpaid..."),this.onVPAIDLoadCompleteHandler(),this._isLoaderRunnig=!0},PMVpaidPlayer.prototype.start=function(){if(console.log("Inside PMVpaidPlayer:start()"),!this._adStartRequested){if(this._adStartRequested=!0,!this.checkVpaidProperty("startAd"))return;console.log("PMVpaidPlayer:start() - Calling 3rd-party VPAID startAd()..."),this._protocolTimer.start(),this._tpVPAIDAd.startAd(),console.log("PMVpaidPlayer:start() - 3rd-party VPAID startAd() finished...")}},PMVpaidPlayer.prototype.pause=function(){console.log("Inside PMVpaidPlayer:pause()"),this._tpVPAIDAd.hasOwnProperty("pauseAd")&&this._tpVPAIDAd.pauseAd()},PMVpaidPlayer.prototype.resume=function(){console.log("Inside PMVpaidPlayer:resume()"),this._tpVPAIDAd.hasOwnProperty("resumeAd")&&this._tpVPAIDAd.resumeAd()},PMVpaidPlayer.prototype.stop=function(){console.log("Inside PMVpaidPlayer:stop()"),this.checkVpaidProperty("stopAd")&&(this._protocolTimer.start(),this._tpVPAIDAd.stopAd())},PMVpaidPlayer.prototype.changeVolume=function(e){console.log("Inside PMVpaidPlayer:changeVolume()"),this._tpVPAIDAd.hasOwnProperty("adVolume")&&(this._tpVPAIDAd.adVolume=e);
},PMVpaidPlayer.prototype.getAdCompanions=function(){console.log("Inside PMVpaidPlayer:getAdCompanions()");var e="";return null!=this._tpVPAIDAd&&this._tpVPAIDAd.hasOwnProperty("adCompanions")&&(e=this._tpVPAIDAd.adCompanions),StringUtils.isBlank(e)&&(e=this._adElement.getCompanionsAdsXML()),e},PMVpaidPlayer.prototype.initVpaidAd=function(){console.log("Inside PMVpaidPlayer:initVpaidAd()"),this.addTPEventListeners(),console.log("PMVpaidPlayer:initVpaidAd() - calling 3rd-party initAd() ..."),this._protocolTimer.start(),this._tpVPAIDAd.initAd(this._initWidth,this._initHeight,this._viewMode,this._desiredBitrate,this._creativeData,this._environmentVars),console.log("PMVpaidPlayer:initVpaidAd() - 3rd-party initAd() Finished ")},PMVpaidPlayer.prototype.onVPAIDLoadCompleteHandler=function(e){this._protocolTimer.stop(),console.log("Inside PMVpaidPlayer:onVPAIDLoadCompleteHandler()"),this.removeLoaderListeners(),this._tpVPAIDAddom=this._pmVPAID.addChild(this._tpVPAIDAdUrl,this.onTPJSLoaded,this)},PMVpaidPlayer.prototype.onTPJSLoaded=function(e){this._tpVPAIDAd=e,this.initVpaidAd()},PMVpaidPlayer.prototype.onVAPIDLoadErrorHandler=function(e){this._protocolTimer.stop(),this.removeLoaderListeners(),console.log("Error while loading 3rd-party VAPID"),e.preventDefault(),e.stopImmediatePropagation(),new ErrorHandler(ErrorMessage.VPAID_GENERAL_ERROR).handleError(this._adElement.getErrorEventURI()),this.handleVpaidError()},PMVpaidPlayer.prototype.tpAdClickThruHandler=function(e){},PMVpaidPlayer.prototype.tpAdDurationChangeHandler=function(e){console.log("Inside PMVpaidPlayer - 3rd-party dispatched AdDurationChange event"),this._pmVPAID.resetAdDuration()},PMVpaidPlayer.prototype.tpAdErrorHandler=function(e){console.log(e),this._protocolTimer.stop(),console.log("Inside PMVpaidPlayer - 3rd-party dispatched AdError event"),new ErrorHandler(ErrorMessage.VPAID_GENERAL_ERROR).handleError(this._adElement.getErrorEventURI()),this.handleVpaidError()},PMVpaidPlayer.prototype.tpAdExpandedChangeHandler=function(e){console.log("Inside PMVpaidPlayer - 3rd-party dispatched Ad_expanded_change event"),this._pmVPAID.dispatchAdEvent(AdEvent.AD_EXPANDED_CHANGE)},PMVpaidPlayer.prototype.tpAdImpressionHandler=function(e){this._protocolTimer.running&&(this._protocolTimer.stop(),console.log("Inside PMVpaidPlayer - 3rd-party dispatched Ad_Impression event"),this._pmVPAID.executeAdStartedEvent(),this._pmVPAID.executeImpressionEvent()),this._tpVPAIDAddom.removeEventListener(AdEvent.AD_IMPRESSION,this.tpAdImpressionHandler)},PMVpaidPlayer.prototype.tpAdLoadedHandler=function(e){this._protocolTimer.running&&(this._protocolTimer.stop(),console.log("Inside PMVpaidPlayer - 3rd-party dispatched Ad_Loaded event"),this._pmVPAID.dispatchAdLoadedEvent()),this._tpVPAIDAddom.removeEventListener(AdEvent.AD_LOADED,this.tpAdLoadedHandler)},PMVpaidPlayer.prototype.tpAdLogHandler=function(e){console.log("========="),console.log(e),console.log("=========")},PMVpaidPlayer.prototype.tpAdPausedHandler=function(e){console.log("Inside PMVpaidPlayer - 3rd-party dispatched Ad_Paused event"),this._pmVPAID.executeTrackingEvent(TrackingEventTypes.PAUSE)},PMVpaidPlayer.prototype.tpAdPlayingHandler=function(e){console.log("Inside PMVpaidPlayer - 3rd-party dispatched Ad_Playing event"),this._pmVPAID.executeTrackingEvent(TrackingEventTypes.RESUME)},PMVpaidPlayer.prototype.tpAdRemainingTimeChangeHandler=function(e){},PMVpaidPlayer.prototype.tpAdSizeChangeHandler=function(e){console.log("Inside PMVpaidPlayer - 3rd-party dispatched Ad_size_change event"),this._pmVPAID.dispatchAdEvent(AdEvent.AD_SIZE_CHANGE)},PMVpaidPlayer.prototype.tpAdSkippableStateChangeHandler=function(e){},PMVpaidPlayer.prototype.tpAdSkippedHandler=function(e){this._tpVPAIDAddom.removeEventListener(AdEvent.AD_SKIPPED,this.tpAdSkippedHandler)},PMVpaidPlayer.prototype.tpAdStartedHandler=function(e){this._protocolTimer.running&&console.log("Inside PMVpaidPlayer - 3rd-party dispatched Ad_Started event"),this._tpVPAIDAddom.removeEventListener(AdEvent.AD_STARTED,this.tpAdStartedHandler)},PMVpaidPlayer.prototype.tpAdStoppedHandler=function(e){this._protocolTimer.stop(),console.log("Inside PMVpaidPlayer - 3rd-party dispatched AD_STOPPED event"),this.resetPMPlayer(),this._pmVPAID.dispatchAdEvent(AdEvent.AD_STOPPED)},PMVpaidPlayer.prototype.tpAdUserAcceptInvitationHandler=function(e){},PMVpaidPlayer.prototype.tpAdUserCloseHandler=function(e){},PMVpaidPlayer.prototype.tpAdUserMinimizeHandler=function(e){},PMVpaidPlayer.prototype.tpAdVideoCompleteHandler=function(e){console.log("Inside PMVpaidPlayer - 3rd-party dispatched AD_VIDEO_COMPLETE event"),this._pmVPAID.executeTrackingEvent(TrackingEventTypes.COMPLETE),this._tpVPAIDAddom.removeEventListener(AdEvent.AD_VIDEO_COMPLETE,this.tpAdVideoCompleteHandler)},PMVpaidPlayer.prototype.tpAdVideoFirstQuartileHandler=function(e){console.log("Inside PMVpaidPlayer - 3rd-party dispatched AD_VIDEO_FIRST_QUARTILE event"),this._pmVPAID.executeTrackingEvent(TrackingEventTypes.FIRST_QUARTILE),this._tpVPAIDAddom.removeEventListener(AdEvent.AD_VIDEO_FIRST_QUARTILE,this.tpAdVideoFirstQuartileHandler)},PMVpaidPlayer.prototype.tpAdVideoMidpointHandler=function(e){console.log("Inside PMVpaidPlayer - 3rd-party dispatched AD_VIDEO_MIDPOINT event"),this._pmVPAID.executeTrackingEvent(TrackingEventTypes.MIDPOINT),this._tpVPAIDAddom.removeEventListener(AdEvent.AD_VIDEO_MIDPOINT,this.tpAdVideoMidpointHandler)},PMVpaidPlayer.prototype.tpAdVideoStartHandler=function(e){console.log("Inside PMVpaidPlayer - 3rd-party dispatched AD_VIDEO_START event"),this._pmVPAID.executeTrackingEvent(TrackingEventTypes.AD_VIDEO_START),this._tpVPAIDAddom.removeEventListener(AdEvent.AD_VIDEO_START,this.tpAdVideoStartHandler)},PMVpaidPlayer.prototype.tpAdVideoThirdQuartileHandler=function(e){console.log("Inside PMVpaidPlayer - 3rd-party dispatched THIRD_QUARTILE event"),this._pmVPAID.executeTrackingEvent(TrackingEventTypes.THIRD_QUARTILE),this._tpVPAIDAddom.removeEventListener(AdEvent.AD_VIDEO_THIRD_QUARTILE,this.tpAdVideoThirdQuartileHandler)},PMVpaidPlayer.prototype.tpAdVolumeChangeHandler=function(e){this._pmVPAID.dispatchAdEvent(AdEvent.AD_VOLUME_CHANGE)},PMVpaidPlayer.prototype.getTotalAdDuration=function(){var e=0;return null!=this._tpVPAIDAd&&this._tpVPAIDAd.hasOwnProperty("adDuration")?e=this._tpVPAIDAd.adDuration:null!=this._tpVPAIDAd&&this._tpVPAIDAd.hasOwnProperty("adRemainingTime")&&(e=this._tpVPAIDAd.adRemainingTime),e},PMVpaidPlayer.prototype.getRemainingAdDuration=function(){var e=0;return null!=this._tpVPAIDAd&&this._tpVPAIDAd.hasOwnProperty("adRemainingTime")&&(e=this._tpVPAIDAd.adRemainingTime),e},PMVpaidPlayer.prototype.addTPEventListeners=function(){var e={AdStarted:this.tpAdStartedHandler,AdStopped:this.tpAdStoppedHandler,AdSkipped:this.tpAdSkippedHandler,AdLoaded:this.tpAdLoadedHandler,AdLinearChange:this.tpAdLinearChangeHandler,AdSizeChange:this.tpAdSizeChangeHandler,AdExpandedChange:this.tpAdExpandedChangeHandler,AdSkippableStateChange:this.tpAdSkippableStateChangeHandler,AdDurationChange:this.tpAdDurationChangeHandler,AdRemainingTimeChange:this.tpAdRemainingTimeChangeHandler,AdVolumeChange:this.tpAdVolumeChangeHandler,AdImpression:this.tpAdImpressionHandler,AdClickThru:this.tpAdClickThruHandler,AdInteraction:this.tpAdInteractionHandler,AdVideoStart:this.tpAdVideoStartHandler,AdVideoFirstQuartile:this.tpAdVideoFirstQuartileHandler,AdVideoMidpoint:this.tpAdVideoMidpointHandler,AdVideoThirdQuartile:this.tpAdVideoThirdQuartileHandler,AdVideoComplete:this.tpAdVideoCompleteHandler,AdUserAcceptInvitation:this.onAdUserAcceptInvitation,AdUserMinimize:this.tpAdUserMinimizeHandler,AdUserClose:this.tpAdUserCloseHandler,AdPaused:this.tpAdPausedHandler,AdPlaying:this.tpAdPlayingHandler,AdError:this.tpAdErrorHandler,AdLog:this.tpAdLogHandler};for(var t in e)this._tpVPAIDAd.subscribe(e[t],t,this)},PMVpaidPlayer.prototype.removeTPEventListeners=function(){var e={AdStarted:this.tpAdStartedHandler,AdStopped:this.tpAdStoppedHandler,AdSkipped:this.tpAdSkippedHandler,AdLoaded:this.tpAdLoadedHandler,AdLinearChange:this.tpAdLinearChangeHandler,AdSizeChange:this.tpAdSizeChangeHandler,AdExpandedChange:this.tpAdExpandedChangeHandler,AdSkippableStateChange:this.tpAdSkippableStateChangeHandler,AdDurationChange:this.tpAdDurationChangeHandler,AdRemainingTimeChange:this.tpAdRemainingTimeChangeHandler,AdVolumeChange:this.tpAdVolumeChangeHandler,AdImpression:this.tpAdImpressionHandler,AdClickThru:this.tpAdClickThruHandler,AdInteraction:this.tpAdInteractionHandler,AdVideoStart:this.tpAdVideoStartHandler,AdVideoFirstQuartile:this.tpAdVideoFirstQuartileHandler,AdVideoMidpoint:this.tpAdVideoMidpointHandler,AdVideoThirdQuartile:this.tpAdVideoThirdQuartileHandler,AdVideoComplete:this.tpAdVideoCompleteHandler,AdUserAcceptInvitation:this.onAdUserAcceptInvitation,AdUserMinimize:this.tpAdUserMinimizeHandler,AdUserClose:this.tpAdUserCloseHandler,AdPaused:this.tpAdPausedHandler,AdPlaying:this.tpAdPlayingHandler,AdError:this.tpAdErrorHandler,AdLog:this.tpAdLogHandler};for(var t in e)this._tpVPAIDAd.unsubscribe(e[t],t)},PMVpaidPlayer.prototype.resize=function(e,t,i){console.log("Inside PMVpaidPlayer:resize()"),this._tpVPAIDAd.resizeAd(e,t,i)},PMVpaidPlayer.prototype.expand=function(){console.log("Inside PMVpaidPlayer:expand()"),this._tpVPAIDAd.expandAd()},PMVpaidPlayer.prototype.collapse=function(){console.log("Inside PMVpaidPlayer:collapse()"),this._tpVPAIDAd.collapseAd()},PMVpaidPlayer.prototype.addLoaderListeners=function(){console.log("loadVPAID(): added event listener...")},PMVpaidPlayer.prototype.removeLoaderListeners=function(){this._isLoaderRunnig=!1},PMVpaidPlayer.prototype.onProtocolTimeOut=function(e){this._protocolTimer.stop(),this._isLoaderRunnig&&(console.log("3rd-Party VPAID Load timed out !!!"),this.removeLoaderListeners(),this._loader.close()),console.log("Protocol time out @"+this._pmVPAID._currentVpaidPhase),this.handleVpaidError()},PMVpaidPlayer.prototype.handleVpaidError=function(){this.resetPMPlayer()},PMVpaidPlayer.prototype.resetPMPlayer=function(){null!=this._tpVPAIDAd&&(this.removeTPEventListeners(),this._tpVPAIDAd=null),this._loader=null,this._protocolTimer.stop(),console.log("Done with 3rd-party VPAID cleaned up")},PMVpaidPlayer.prototype.checkVpaidProperty=function(e){return null!=this._tpVPAIDAd&&"function"==typeof this._tpVPAIDAd[e]||(console.log("Property: "+e+" is missing in 3rd-party"),this.handleVpaidError(),!1)};
